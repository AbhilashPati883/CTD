-- Databricks notebook source
CREATE WIDGET TEXT processing_date DEFAULT '';


-- COMMAND ----------

set spark.databricks.delta.autoCompact.enabled=true;

set spark.databricks.delta.optimizeWrite.enabled=true;

-- COMMAND ----------

%python
from pyspark.sql.types import StructType, StructField, StringType, TimestampType, DateType
from pyspark.sql.functions import sha2, col, concat_ws
from pyspark.sql.functions import lit
import re
from datetime import datetime
import pytz

-- COMMAND ----------

%python
scheduled_run_date = datetime.utcnow()

dbutils.widgets.text("job_schedule_id", "")
job_schedule_id = dbutils.widgets.get("job_schedule_id")

dbutils.widgets.text("adf_run_id", "")
adf_run_id = dbutils.widgets.get("adf_run_id")

job_run_status = "Succeeded"

notebook_path=dbutils.notebook.entry_point.getDbutils().notebook().getContext().notebookPath().get()

format_string = "%Y-%m-%d %H:%M:%S"
execution_start_time = datetime.utcnow().strftime(format_string)
    
-- COMMAND ----------

WITH CTE_CUST_DIM AS
 (
	SELECT DISTINCT NON_HOME_DC_FL_IND,EXTRNL_REF_2_CD,EXTRNL_REF_1_CD,SRC_SYS_CD,SLS_ORDR_NUM,SLS_ORDR_LINE_NBR 
	FROM SCRU_IM.SLS_ORDR_CUST_DIM 
	WHERE SRC_SYS_CD='US1'
),

APAC_CST_DELV_TRN AS 
(
SELECT *,
SUM(CST_DELV_TRN.GRS_WT_MEAS) OVER (PARTITION BY CST_DELV_TRN.DELV_NUM) AS SUM_GRS_WT_MEAS,
CST_DELV_TRN.GRS_WT_MEAS/(SUM(CST_DELV_TRN.GRS_WT_MEAS) OVER (PARTITION BY CST_DELV_TRN.DELV_NUM)) AS GRS_WT_RATIO
FROM DELV.CST_DELV_TRN AS CST_DELV_TRN
WHERE CST_DELV_TRN.SRC_SYS_CD='CAP' AND CST_DELV_TRN.ACTL_SKU_DELV_QTY > 0
),

APAC_CST_TPT_TRN AS
(
SELECT CST_TPT_TRN.DELV_NUM AS DELV_NUM,
CST_TPT_TRN.SRC_SYS_CD AS SRC_SYS_CD,
SUM(CST_TPT_TRN.CROS_DK_COST_AMT) AS CROS_DK_COST_AMT, 
SUM(CST_TPT_TRN.FUEL_SURC_COST_AMT) AS FUEL_SURC_COST_AMT,
SUM(CST_TPT_TRN.MLT_DRP_COST_AMT) AS MLT_DRP_COST_AMT,
SUM(CST_TPT_TRN.OUTB_EXTRA_COST_AMT) AS OUTB_EXTRA_COST_AMT,
SUM(CST_TPT_TRN.OVNT_COST_AMT) AS OVNT_COST_AMT,
SUM(CST_TPT_TRN.OUTB_TRSPN_TAX_AMT) AS OUTB_TRSPN_TAX_AMT,
SUM(CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT) AS OUTB_TRSPN_INCL_TAX_COST_AMT,
SUM(CST_TPT_TRN.TRSPN_BASE_RT) AS TRSPN_BASE_RT,
SUM(CST_TPT_TRN.TRSPN_OTH_COST_AMT) AS TRSPN_OTH_COST_AMT, 
SUM(CST_TPT_TRN.UNLD_COST_AMT) AS UNLD_COST_AMT,
SUM(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT) AS OUTB_TRSPN_EXCL_TAX_COST_AMT,
SUM(CST_TPT_TRN.WAIT_TIME_COST_AMT) AS WAIT_TIME_COST_AMT,
SUM(CST_TPT_TRN.WT_AMT_COST) AS WT_AMT_COST,
SUM(CST_TPT_TRN.TRAVL_DSTC_COST_AMT) AS TRAVL_DSTC_COST_AMT
FROM DELV.CST_TPT_TRN
WHERE CST_TPT_TRN.SRC_SYS_CD='CAP'
GROUP BY CST_TPT_TRN.DELV_NUM, CST_TPT_TRN.SRC_SYS_CD
)


INSERT OVERWRITE DELV.CST_TO_DELV_DETL

--Below query is generated from : Supply_Chain/Deliver/CostToDeliver_Final_Transaction_APAC.csv
SELECT DISTINCT
	CST_DELV_TRN.DELV_NUM AS DELV_NUM,
	CST_DELV_TRN.DELV_LINE_NBR AS DELV_LINE_NBR,
	CST_DELV_TRN.SLS_ORDR_NUM AS SLS_ORDR_NUM,
	CST_DELV_TRN.SLS_ORDR_LINE_NBR AS SLS_ORDR_LINE_NBR,
	CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS SLS_ORDR_CRT_DTTM,
	CST_SLS_TRN.SLS_ORDR_TYPE_CD AS SLS_ORDR_TYPE_CD,
	CST_SLS_TRN.SLS_ORDR_TYPE_DESC AS SLS_ORDR_TYPE_DESC,
	CST_SLS_TRN.PLNT_CD AS PLNT_CD,
	CST_SLS_TRN.PLNT_NM AS PLNT_NM,
	CST_SLS_TRN.PLNT_CITY_NM AS PLNT_CITY_NM,
	CST_SLS_TRN.PLNT_CTRY_CD AS PLNT_CTRY_CD,
	CST_SLS_TRN.PLNT_PSTL_CD_NUM AS PLNT_PSTL_CD_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NUM AS SOLD_TO_CUST_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NM AS SOLD_TO_CUST_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CITY_NM AS SOLD_TO_CUST_CITY_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CTRY_CD AS SOLD_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SOLD_TO_ST_PRVNC_CD AS SOLD_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SOLD_TO_CUST_PSTL_NUM AS SOLD_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NUM AS SHIP_TO_CUST_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NM AS SHIP_TO_CUST_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CITY_NM AS SHIP_TO_CUST_CITY_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CTRY_CD AS SHIP_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SHIP_TO_ST_PRVNC_CD AS SHIP_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SHIP_TO_CUST_PSTL_NUM AS SHIP_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.CUST_PO_TYPE_CD AS CUST_PO_TYPE_CD,
	CST_SLS_TRN.CUST_PO_TYPE_DESC AS CUST_PO_TYPE_DESC,
	CST_SLS_TRN.SLORG_NUM AS SLORG_NUM,
	CST_SLS_TRN.DSTR_CHNL_CD AS DSTR_CHNL_CD,
	CST_SLS_TRN.DSTR_CHNL_DESC AS DSTR_CHNL_DESC,
	CST_SLS_TRN.SLS_ORDR_QTY AS SLS_ORDR_QTY,
	CST_SLS_TRN.ORDR_BASE_UOM_CD AS ORDR_BASE_UOM_CD,
	CST_SLS_TRN.SLS_UOM_ORDR_QTY AS SLS_UOM_ORDR_QTY,
	CST_SLS_TRN.SLS_UOM_CD AS SLS_UOM_CD,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_COST_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_COST_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0)* CST_DELV_TRN.ACTL_SKU_DELV_QTY)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE)AS NET_VAL_AMT_SLS,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_1_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_1_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_2_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_2_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_3_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_3_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_4_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_4_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_5_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_5_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_6_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_6_AMT,
	CST_SLS_TRN.CUST_CLUS_CD AS CUST_CLUS_CD,
	CST_SLS_TRN.CUST_SUB_CLUS_CD AS CUST_SUB_CLUS_CD,
	CST_SLS_TRN.CUST_REGN_MKT_CD AS CUST_REGN_MKT_CD,
	CST_SLS_TRN.CUST_TTL_ENT_CD AS CUST_TTL_ENT_CD,
	CST_SLS_TRN.CUST_RTL_BNR_CD AS CUST_RTL_BNR_CD,
	CST_SLS_TRN.CUST_INDSTR_1_CD AS CUST_INDSTR_1_CD,
	CST_SLS_TRN.CUST_INDSTR_2_CD AS CUST_INDSTR_2_CD,
	CST_SLS_TRN.CUST_INDSTR_3_CD AS CUST_INDSTR_3_CD,
	CST_SLS_TRN.CUST_INDSTR_4_CD AS CUST_INDSTR_4_CD,
	CST_SLS_TRN.CUST_INDSTR_5_CD AS CUST_INDSTR_5_CD,
	CST_SLS_TRN.FISC_MO_SHRT_NM AS FISC_MO_SHRT_NM,
	CST_SLS_TRN.FISC_YR_NBR AS FISC_YR_NBR,
	CST_SLS_TRN.CAL_DAY_SHRT_NM AS CAL_DAY_SHRT_NM,
	CST_SLS_TRN.FISC_WK_NBR AS FISC_WK_NBR,
	CST_SLS_TRN.FISC_QTR_NM AS FISC_QTR_NM,
	CST_SLS_TRN.FISC_MO_STRT_DT AS FISC_MO_STRT_DT,
	CST_SLS_TRN.FISC_MO_END_DT AS FISC_MO_END_DT,
	CST_DELV_TRN.DELV_TYPE_CD AS DELV_TYPE_CD,
	CST_DELV_TRN.DELV_CRT_DTTM AS DELV_CRT_DTTM,
	CST_DELV_TRN.MATL_NUM AS MATL_NUM,
	CST_DELV_TRN.RTE_NUM AS RTE_NUM,
	CST_DELV_TRN.PICK_DTTM AS PICK_DTTM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY AS ACTL_SKU_DELV_QTY,
	CST_DELV_TRN.DELV_BASE_UOM_CD AS DELV_BASE_UOM_CD,
	CST_DELV_TRN.ACTL_SLS_UNIT_DELV_QTY AS ACTL_SLS_UNIT_DELV_QTY,
	CST_DELV_TRN.MATL_SHRT_DESC AS MATL_SHRT_DESC,
	CST_DELV_TRN.GLBL_BRND_DESC AS GLBL_BRND_DESC,
	CST_DELV_TRN.RGN_BRND_DESC AS RGN_BRND_DESC,
	CST_DELV_TRN.RGN_MEGA_BRND_DESC AS RGN_MEGA_BRND_DESC,
	CST_DELV_TRN.PROD_CAT_DESC AS PROD_CAT_DESC,
	CST_DELV_TRN.TRSPN_GRP_CD AS TRSPN_GRP_CD,
	CST_DELV_TRN.RGN_BASE_PROD_DESC AS RGN_BASE_PROD_DESC,
	CST_DELV_TRN.RGN_VRNT_DESC AS RGN_VRNT_DESC,
	CST_DELV_TRN.RGN_PUT_UP_DESC AS RGN_PUT_UP_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_1_DESC AS MATL_GLOBL_HIER_1_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_2_DESC AS MATL_GLOBL_HIER_2_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_3_DESC AS MATL_GLOBL_HIER_3_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_4_DESC AS MATL_GLOBL_HIER_4_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_5_DESC AS MATL_GLOBL_HIER_5_DESC,
	CST_MATL_UOM.GRS_WT_MEAS_PC AS GRS_WT_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS FCTR_NUMRTR_MEAS_CS,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_CS AS FCTR_DNMNTR_MEAS_CS,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PC AS FCTR_NUMRTR_MEAS_PC,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PC AS FCTR_DNMNTR_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS FCTR_NUMRTR_MEAS_PL,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PL AS FCTR_DNMNTR_MEAS_PL,
	CST_MATL_UOM.VOL_MEAS_CS AS VOL_MEAS_CS,
	CST_MATL_UOM.VOL_MEAS_PC AS VOL_MEAS_PC,
	CST_MATL_UOM.VOL_UOM_MEAS AS VOL_UOM_MEAS,
	CST_MATL_UOM.VOL_MEAS_PL AS VOL_MEAS_PL,
	CST_MATL_UOM.CS_PER_PLLT_UOM AS CS_PER_PLLT_UOM,
	CST_TPT_TRN.TRSPN_OTH_COST_AMT AS TRSPN_OTH_COST_AMT,
	CST_TPT_TRN.FUEL_SURC_COST_AMT AS FUEL_SURC_COST_AMT,
	CST_TPT_TRN.MLT_DRP_COST_AMT AS MLT_DRP_COST_AMT,
	CST_TPT_TRN.OVNT_COST_AMT AS OVNT_COST_AMT,
	CST_TPT_TRN.TRAVL_DSTC_COST_AMT AS TRAVL_DSTC_COST_AMT,
	CST_TPT_TRN.UNLD_COST_AMT AS UNLD_COST_AMT,
	CST_TPT_TRN.WAIT_TIME_COST_AMT AS WAIT_TIME_COST_AMT,
	CST_TPT_TRN.WT_AMT_COST AS WT_AMT_COST,
	CST_TPT_TRN.CROS_DK_COST_AMT AS CROS_DK_COST_AMT,
	CST_TPT_TRN.TRSPN_BASE_RT AS TRSPN_BASE_RT,
	CST_TPT_TRN.PER_KM_TRSPN_COST_AMT AS PER_KM_TRSPN_COST_AMT,
	CST_TPT_TRN.UTLZ_LTL_LCL_PCT AS UTLZ_LTL_LCL_PCT,
	CST_TPT_TRN.DELV_DSTC_IN_KM AS DELV_DSTC_IN_KM,
	CST_TPT_TRN.BILL_OF_LDNG AS BILL_OF_LDNG,
	CST_TPT_TRN.SHIP_MODE AS SHIP_MODE,
	CST_TPT_TRN.TRK_MAX_CAPY_CBM AS TRK_MAX_CAPY_CBM,
	CST_TPT_TRN.TRK_MAX_CAPY_KG AS TRK_MAX_CAPY_KG,
	CST_TPT_TRN.GRS_VOL_CBM AS GRS_VOL_CBM,
	CST_TPT_TRN.NET_VOL_CBM AS NET_VOL_CBM,
	CST_TPT_TRN.TRSPN_TYPE_CD AS TRSPN_TYPE_CD,
	CST_TPT_TRN.SHIP_TYPE_CD AS SHIP_TYPE_CD,
	CST_TPT_TRN.NET_WT_QTY AS NET_WT_QTY,
	CST_TPT_TRN.GRS_WT_QTY AS GRS_WT_QTY,
	CST_TPT_TRN.CHRG_MECH_CD AS CHRG_MECH_CD,
	CST_TPT_TRN.RT_CARD_ID AS RT_CARD_ID,
	CST_TPT_TRN.ORIG_CD AS ORIG_CD,
	CST_TPT_TRN.DEST_CD AS DEST_CD,
	CST_TPT_TRN.SNDR_ST_CD AS SNDR_ST_CD,
	CST_TPT_TRN.RCVR_ST_CD AS RCVR_ST_CD,
	CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT AS OUTB_TRSPN_INCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT AS OUTB_TRSPN_EXCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_TAX_AMT AS OUTB_TRSPN_TAX_AMT,
	CST_TPT_TRN.DIST_TRVL_RATE_AMT AS DIST_TRVL_RATE_AMT,
	CST_TPT_TRN.WAIT_TIME_RATE_AMT AS WAIT_TIME_RATE_AMT,
	CST_TPT_TRN.RATE_PER_KG_AMT AS RATE_PER_KG_AMT,
	CST_TPT_TRN.FUEL_SURC_PCT AS FUEL_SURC_PCT,
	CST_TPT_TRN.DELV_VEND_NM AS DELV_VEND_NM,
	CST_TPT_TRN.LANE_ID AS LANE_ID,
	CST_TPT_TRN.CARR_NM AS CARR_NM,
	CST_TPT_TRN.TRK_TYPE_DESC AS TRK_TYPE_DESC,
	CST_TPT_TRN.ACTL_DC_DSPCH_FRM_DTTM AS ACTL_DC_DSPCH_FRM_DTTM,
	CST_TPT_TRN.SHIP_REF_NUM AS SHIP_REF_NUM,
	CST_TPT_TRN.SHIP_PRIR_DESC AS SHIP_PRIR_DESC,
	CST_TPT_TRN.OUTB_EXTRA_COST_AMT AS OUTB_EXTRA_COST_AMT,
	CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT AS OUTB_TPT_VOL_COST_AMT,
	CST_TPT_TRN.DELV_DTTM AS DELV_DTTM,
	CST_WH_TRN.LBR_COST_AMT_PL AS LBR_COST_AMT_PL,
	CST_WH_TRN.LBR_COST_AMT_CS AS LBR_COST_AMT_CS,
	CST_WH_TRN.LBR_COST_AMT_PC AS LBR_COST_AMT_PC,
	CST_WH_TRN.TTL_CUST_SRVC_COST_AMT AS TTL_CUST_SRVC_COST_AMT,
	CST_WH_TRN.FX_COST_AMT AS FX_COST_AMT,
	CST_WH_TRN.STRG_COST_AMT AS STRG_COST_AMT,
	CST_WH_TRN.OTH_COST_AMT AS OTH_COST_AMT,
	CST_WH_TRN.CNSUM_COST_AMT AS CNSUM_COST_AMT,
	CST_WH_TRN.OUTB_HNDG_COST_AMT AS OUTB_HNDG_COST_AMT,
	CST_WH_TRN.TTL_WH_COST_AMT AS TTL_WH_COST_AMT,
	CASE
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PC', 'EA') THEN CST_SLS_TRN.SLS_ORDR_QTY
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL)
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS)
	ELSE 0
	END AS SLS_ORDR_QTY_PC,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS SLS_ORDR_QTY_CASE,
	CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC AS SLS_ORDR_QTY_PC_CBM,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS SLS_ORDR_QTY_PLLT,
	CASE
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PC', 'EA') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS
	ELSE 0
	END AS ACTL_DELV_QTY_PC,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS ACTL_DELV_QTY_CASE,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.VOL_MEAS_PC AS ACTL_DELV_QTY_PC_CBM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS ACTL_DELV_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT AS PICK_PACK_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_CASE AS PICK_PACK_QTY_CASE,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PC AS PICK_PACK_QTY_PC,
	(NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) AS TTL_DELV_COST_AMT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC)) AS TTL_DELV_COST_AMT_CBM,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL) AS TTL_DELV_COST_AMT_PLLT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS) AS TTL_DELV_COST_AMT_CASE,
	CST_SLS_TRN.LCL_CRNCY_CD AS LCL_CRNCY_CD,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_COST_AMT) AS SLS_ITEM_COST_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_1_AMT) AS SLS_ITEM_SUB_1_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_2_AMT) AS SLS_ITEM_SUB_2_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_3_AMT) AS SLS_ITEM_SUB_3_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_4_AMT) AS SLS_ITEM_SUB_4_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_5_AMT) AS SLS_ITEM_SUB_5_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_6_AMT) AS SLS_ITEM_SUB_6_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0)* CST_DELV_TRN.ACTL_SKU_DELV_QTY)) AS NET_VAL_USD_AMT_SLS,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.CNSUM_COST_AMT) AS CNSUM_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.FX_COST_AMT) AS FX_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.OTH_COST_AMT) AS OTH_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.OUTB_HNDG_COST_AMT) AS OUTB_HNDG_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.LBR_COST_AMT_PL) AS LBR_COST_USD_AMT_PL,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.LBR_COST_AMT_CS) AS LBR_COST_USD_AMT_CS,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.STRG_COST_AMT) AS STRG_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.TTL_CUST_SRVC_COST_AMT) AS TTL_CUST_SRVC_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.LBR_COST_AMT_PC) AS LBR_COST_USD_AMT_PC,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.TTL_WH_COST_AMT) AS TTL_WH_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.CROS_DK_COST_AMT) AS CROS_DK_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.FUEL_SURC_COST_AMT) AS FUEL_SURC_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.MLT_DRP_COST_AMT) AS MLT_DRP_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_EXTRA_COST_AMT) AS OUTB_EXTRA_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT) AS OUTB_TPT_VOL_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OVNT_COST_AMT) AS OVNT_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT) AS OUTB_TRSN_EXCL_TAX_CST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT) AS OUTB_TRSN_INCL_TAX_CST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TRSPN_TAX_AMT) AS OUTB_TRSN_TAX_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.TRSPN_BASE_RT) AS TRSPN_BASE_RT_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.PER_KM_TRSPN_COST_AMT) AS PER_KM_TRSPN_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.TRSPN_OTH_COST_AMT) AS TRSPN_OTH_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.TRAVL_DSTC_COST_AMT) AS TRAVL_DSTC_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.UNLD_COST_AMT) AS UNLD_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.WAIT_TIME_COST_AMT) AS WAIT_TIME_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.WAIT_TIME_RATE_AMT) AS WAIT_TIME_RATE_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.WT_AMT_COST) AS WT_AMT_COST_USD,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.DIST_TRVL_RATE_AMT) AS DIST_TRVL_RATE_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.RATE_PER_KG_AMT) AS RATE_PER_KG_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0))) AS TTL_DELV_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC))) AS TTL_DELV_COST_USD_AMT_CBM,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * ((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL)) AS TTL_DELV_COST_USD_AMT_PLLT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * ((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS)) AS TTL_DELV_COST_USD_AMT_CASE,
	CST_SLS_TRN.SLS_ORDR_GEN_NM AS SLS_ORDR_GEN_NM,
	CST_SLS_TRN.REGION_INC AS REGION_INC,
	CST_SLS_TRN.LINE_ITEM_CAT_CD AS LINE_ITEM_CAT_CD,
	CST_DELV_TRN.ACTL_GI_DT AS ACTL_GI_DT,
	'' AS OUT_OF_SRVC_IND,
	CST_SLS_TRN.KEY_CUST_NM AS KEY_CUST_NM,
	CST_SLS_TRN.KEY_CUST_NUM AS KEY_CUST_NUM,   
	CST_TPT_TRN.LD_NUM AS LD_NUM,  
	CST_TPT_TRN.PLAN_GI_DT AS PLAN_GI_DT, 
	CST_TPT_TRN.INVC_CRT_DT AS INVC_CRT_DT,
	CST_TPT_TRN.SLS_INVC_NUM AS SLS_INVC_NUM,
	CST_TPT_TRN.PO_NUM AS PO_NUM,
	CST_TPT_TRN.CARR_CD AS CARR_CD, 
	CST_TPT_TRN.CMMDTY_CD AS CMMDTY_CD, 
	CST_TPT_TRN.CARR_PRO_NUM AS CARR_PRO_NUM, 
	CST_TPT_TRN.TMS_MATCH_IND AS TMS_MATCH_IND,
    CST_TPT_TRN.FRGHT_MATCH_IND AS FRGHT_MATCH_IND,
	CST_TPT_TRN.EST_FUEL_SURC_AMT AS EST_FUEL_SURC_AMT,
	CST_TPT_TRN.TOT_ACCSORIAL_PD_AMT AS TOT_ACCSORIAL_PD_AMT,
	CST_TPT_TRN.TOT_FRGHT_CHRG_AMT AS TOT_FRGHT_CHRG_AMT,
	CST_TPT_TRN.TOT_PLAN_COST_AMT AS TOT_PLAN_COST_AMT,
	CST_TPT_TRN.EST_ACTL_DIFF_COST_AMT AS EST_ACTL_DIFF_COST_AMT,
	CST_DELV_TRN.GRS_WT_MEAS AS GRS_WT_MEAS,
	CST_TPT_TRN.INVC_LINE_ITEM_VOL_MEAS AS INVC_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.GRS_WT_ITM_QTY AS GRS_WT_ITM_QTY,
	CST_TPT_TRN.SLS_LINE_ITEM_VOL_MEAS AS SLS_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.PLNT_ADDR_NUM AS PLNT_ADDR_NUM,
	CST_TPT_TRN.SHIP_COND_CD AS SHIP_COND_CD,
	NULL AS NTWK_SHIP_TO_NM,
	CST_TPT_TRN.INVC_CNT AS INVC_CNT,
	CST_TPT_TRN.SLS_CNFRM_CASE_QTY AS SLS_CNFRM_CASE_QTY,
	CST_TPT_TRN.CUST_UNIT_SLS_CNFRM_QTY AS CUST_UNIT_SLS_CNFRM_QTY,
	CST_TPT_TRN.SLS_CNFRM_EA_QTY AS SLS_CNFRM_EA_QTY,
	CST_TPT_TRN.INVC_EA_QTY AS INVC_EA_QTY,
	CST_TPT_TRN.INVC_CASE_QTY AS INVC_CASE_QTY,
	CST_TPT_TRN.SLS_ORDR_CASE_QTY AS SLS_ORDR_CASE_QTY,
	CST_TPT_TRN.SNGL_SRC_MATL_IND AS SNGL_SRC_MATL_IND,
	CST_TPT_TRN.PMT_SYS_DTTM AS PMT_SYS_DTTM,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.CROS_DK_COST_AMT * GRS_WT_RATIO ELSE NULL END AS CROSSDK_WT_BAS_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.FUEL_SURC_COST_AMT * GRS_WT_RATIO ELSE NULL END AS FUEL_SURC_WT_BAS_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.MLT_DRP_COST_AMT * GRS_WT_RATIO ELSE NULL END AS MULTIDROP_WT_BAS_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.OUTB_EXTRA_COST_AMT * GRS_WT_RATIO ELSE NULL END AS OUTB_WT_BAS_COST_EXTRA_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.OVNT_COST_AMT * GRS_WT_RATIO ELSE NULL END AS OVNT_WT_BAS_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.OUTB_TRSPN_TAX_AMT * GRS_WT_RATIO ELSE NULL END AS TRNSP_WT_BAS_COST_TAX_AMT,	
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.OUTB_TRSPN_INCL_TAX_COST_AMT * GRS_WT_RATIO ELSE NULL END AS TRNSP_WT_BAS_COST_INC_TAX_AMT,
	NULL AS TRNSP_WT_BAS_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.TRSPN_BASE_RT * GRS_WT_RATIO ELSE NULL END AS TRNSP_WT_BAS_BASE_RT_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.TRSPN_OTH_COST_AMT * GRS_WT_RATIO ELSE NULL END AS TRNSP_WT_BAS_OTH_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.UNLD_COST_AMT * GRS_WT_RATIO ELSE NULL END AS UNLDING_WT_BAS_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.OUTB_TRSPN_EXCL_TAX_COST_AMT * GRS_WT_RATIO ELSE NULL END AS TRNSP_WT_BAS_COST_EXCL_TAX_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.WAIT_TIME_COST_AMT * GRS_WT_RATIO ELSE NULL END AS WAIT_TIME_BAS_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.WT_AMT_COST * GRS_WT_RATIO ELSE NULL END AS WT_AMT_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN CST_TPT_TRN_CTE.TRAVL_DSTC_COST_AMT * GRS_WT_RATIO ELSE NULL END AS TRAVL_DSTC_BAS_COST_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.UNLD_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS UNLD_COST_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.CROS_DK_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS CROSSDK_COST_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.FUEL_SURC_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS FUEL_SURC_COST_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.MLT_DRP_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS MULTIDROP_COST_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.OVNT_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS OVNT_COST_USD_WT_BASE_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.OUTB_TRSPN_EXCL_TAX_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS OUTB_EXCL_TAX_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.OUTB_TRSPN_INCL_TAX_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS OUTB_INCL_TAX_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.OUTB_TRSPN_TAX_AMT) * GRS_WT_RATIO ELSE NULL END AS OUTB_TRNSP_TAX_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.TRSPN_BASE_RT) * GRS_WT_RATIO ELSE NULL END AS TRNSP_BASE_RT_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.TRSPN_OTH_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS TRNSP_OTH_COST_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.TRAVL_DSTC_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS TRAVL_DSTC_COST_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.WAIT_TIME_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS WAIT_TIME_COST_USD_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.WT_AMT_COST) * GRS_WT_RATIO ELSE NULL END AS WT_AMT_COST_WT_BAS_AMT,
	CASE WHEN CST_TPT_TRN.MATCH_IND ='MATCH' THEN (CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN_CTE.OUTB_EXTRA_COST_AMT) * GRS_WT_RATIO ELSE NULL END AS OUTB_EXTRA_COST_USD_WT_BAS_AMT,
	NULL AS EST_WT_BAS_FUEL_SURC_AMT,
	NULL AS TOT_ACCSORIAL_PD_WT_BAS_AMT,
	NULL AS TOT_FRGHT_CHRG_WT_BAS_AMT,
	NULL AS TOT_PLAN_WT_BAS_COST_AMT,
	CST_SLS_TRN.ORIG_RQST_DELV_DT AS ORIG_RQST_DELV_DT,
	CST_SLS_TRN.RQST_DELV_DT AS RQST_DELV_DT,
	CST_TPT_TRN.PRC_PCDR1_AMT AS PRC_PCDR1_AMT,
	CST_TPT_TRN.BRND_DESC AS BRND_DESC,
	CST_TPT_TRN.GBU_DESC AS GBU_DESC,
	CST_TPT_TRN.FRAN_DESC AS FRAN_DESC,
	CST_TPT_TRN.MATL_RGM_CLSN_CD AS MATL_RGM_CLSN_CD,
	CST_TPT_TRN.FISC_CUR_MO_IND AS FISC_CUR_MO_IND,
	CST_TPT_TRN.REL_TO_TDY_FISC_MO_CNT AS REL_TO_TDY_FISC_MO_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_QTR_CNT AS REL_TO_TDY_FISC_QTR_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_YR_CNT AS REL_TO_TDY_FISC_YR_CNT,
	CST_TPT_TRN.CAL_DT AS CAL_DT,
	CST_TPT_TRN.FISC_QTR_STRT_DT AS FISC_QTR_STRT_DT,
	CST_TPT_TRN.FISC_QE_DT AS FISC_QE_DT,
	CST_TPT_TRN.FISC_WK_STRT_DT AS FISC_WK_STRT_DT,
	CST_TPT_TRN.FISC_WK_END_DT AS FISC_WK_END_DT,
	'' AS NON_CMPNT_IND,
	CST_SLS_TRN.CUST_SEG_CD AS CUST_SEG_CD,
	'SRC_SYS_CD|^DELV_NUM|^DELV_LINE_NBR|^SLS_ORDR_NUM|^SLS_ORDR_LINE_NBR' AS LOGL_KEY_CMBN_COL_NM,
	CONCAT(CST_DELV_TRN.SRC_SYS_CD, '|^', CST_DELV_TRN.DELV_NUM, '|^', CST_DELV_TRN.DELV_LINE_NBR, '|^', CST_SLS_TRN.SLS_ORDR_NUM, '|^', CST_SLS_TRN.SLS_ORDR_LINE_NBR) AS LOGL_KEY_CMBN_COL_VAL,
	CAST(CURRENT_TIMESTAMP() AS BIGINT) AS DAI_BTCH_ID,
	CURRENT_TIMESTAMP() AS DAI_UPDT_DTTM,
	CURRENT_TIMESTAMP() AS DAI_CRT_DTTM,
	CST_DELV_TRN.SRC_SYS_CD AS SRC_SYS_CD,
	CST_DELV_TRN.CRT_YR_NBR AS CRT_YR_NBR,
	CST_DELV_TRN.CRT_MO_NBR AS CRT_MO_NBR
FROM APAC_CST_DELV_TRN AS CST_DELV_TRN
INNER JOIN DELV.CST_SLS_TRN ON CST_DELV_TRN.DELV_NUM = CST_SLS_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_SLS_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_SLS_TRN.SRC_SYS_CD
INNER JOIN DELIV_FILES.COUNTRY_INC ON CST_DELV_TRN.SRC_SYS_CD = COUNTRY_INC.SRC_SYS_CD AND CST_SLS_TRN.PLNT_CTRY_CD = COUNTRY_INC.PLNT_CTRY_CD
LEFT OUTER JOIN DELV.CST_MATL_UOM ON CST_DELV_TRN.DELV_NUM = CST_MATL_UOM.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_MATL_UOM.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_MATL_UOM.SRC_SYS_CD
LEFT OUTER JOIN DELV.CST_TPT_TRN ON CST_DELV_TRN.DELV_NUM = CST_TPT_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_TPT_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_TPT_TRN.SRC_SYS_CD
LEFT OUTER JOIN DELV.CST_WH_TRN ON CST_DELV_TRN.DELV_NUM = CST_WH_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_WH_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_WH_TRN.SRC_SYS_CD
LEFT OUTER JOIN SC_CORE.MATL_ALT_UOM ON MATL_ALT_UOM.MATL_NUM = CST_MATL_UOM.MATL_NUM AND cst_sls_trn.ORDR_BASE_UOM_CD = matl_alt_uom.matl_alt_uom_cd AND CST_DELV_TRN.SRC_SYS_CD = MATL_ALT_UOM.SRC_SYS_CD
LEFT OUTER JOIN SC_WRK.CURRENCY_RATE AS CURRENCY_RATE_1 ON CST_SLS_TRN.SLS_ORDR_CRNCY_CD = CURRENCY_RATE_1.SOURCE_CURRENCY_CODE AND CAST(CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS DATE) BETWEEN CAST(CURRENCY_RATE_1.BUSINESS_EFFECTIVE_START_DATE AS DATE) AND CAST(CURRENCY_RATE_1.BUSINESS_EFFECTIVE_END_DATE AS DATE)
LEFT OUTER JOIN SC_WRK.CURRENCY_RATE AS CURRENCY_RATE_2 ON CST_SLS_TRN.LCL_CRNCY_CD = CURRENCY_RATE_2.SOURCE_CURRENCY_CODE AND CAST(CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS DATE) BETWEEN CAST(CURRENCY_RATE_2.BUSINESS_EFFECTIVE_START_DATE AS DATE) AND CAST(CURRENCY_RATE_2.BUSINESS_EFFECTIVE_END_DATE AS DATE)
LEFT OUTER JOIN APAC_CST_TPT_TRN AS CST_TPT_TRN_CTE ON CST_TPT_TRN_CTE.DELV_NUM = CST_DELV_TRN.DELV_NUM AND CST_TPT_TRN_CTE.SRC_SYS_CD = CST_DELV_TRN.SRC_SYS_CD
WHERE CST_SLS_TRN.SRC_SYS_CD = 'CAP' AND CST_DELV_TRN.ACTL_SKU_DELV_QTY > 0 AND UPPER(COUNTRY_INC.COUNTRY_INC) ='YES'

UNION ALL

--Below query is generated from : Supply_Chain/Deliver/CostToDeliver_Final_Transaction_CA.csv
SELECT DISTINCT
	CST_DELV_TRN.DELV_NUM AS DELV_NUM,
	CST_DELV_TRN.DELV_LINE_NBR AS DELV_LINE_NBR,
	CST_DELV_TRN.SLS_ORDR_NUM AS SLS_ORDR_NUM,
	CST_DELV_TRN.SLS_ORDR_LINE_NBR AS SLS_ORDR_LINE_NBR,
	CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS SLS_ORDR_CRT_DTTM,
	CST_SLS_TRN.SLS_ORDR_TYPE_CD AS SLS_ORDR_TYPE_CD,
	CST_SLS_TRN.SLS_ORDR_TYPE_DESC AS SLS_ORDR_TYPE_DESC,
	CST_SLS_TRN.PLNT_CD AS PLNT_CD,
	CST_SLS_TRN.PLNT_NM AS PLNT_NM,
	CST_SLS_TRN.PLNT_CITY_NM AS PLNT_CITY_NM,
	CST_SLS_TRN.PLNT_CTRY_CD AS PLNT_CTRY_CD,
	CST_SLS_TRN.PLNT_PSTL_CD_NUM AS PLNT_PSTL_CD_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NUM AS SOLD_TO_CUST_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NM AS SOLD_TO_CUST_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CITY_NM AS SOLD_TO_CUST_CITY_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CTRY_CD AS SOLD_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SOLD_TO_ST_PRVNC_CD AS SOLD_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SOLD_TO_CUST_PSTL_NUM AS SOLD_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NUM AS SHIP_TO_CUST_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NM AS SHIP_TO_CUST_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CITY_NM AS SHIP_TO_CUST_CITY_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CTRY_CD AS SHIP_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SHIP_TO_ST_PRVNC_CD AS SHIP_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SHIP_TO_CUST_PSTL_NUM AS SHIP_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.CUST_PO_TYPE_CD AS CUST_PO_TYPE_CD,
	CST_SLS_TRN.CUST_PO_TYPE_DESC AS CUST_PO_TYPE_DESC,
	CST_SLS_TRN.SLORG_NUM AS SLORG_NUM,
	CST_SLS_TRN.DSTR_CHNL_CD AS DSTR_CHNL_CD,
	CST_SLS_TRN.DSTR_CHNL_DESC AS DSTR_CHNL_DESC,
	CST_SLS_TRN.SLS_ORDR_QTY AS SLS_ORDR_QTY,
	CST_SLS_TRN.ORDR_BASE_UOM_CD AS ORDR_BASE_UOM_CD,
	CST_SLS_TRN.SLS_UOM_ORDR_QTY AS SLS_UOM_ORDR_QTY,
	CST_SLS_TRN.SLS_UOM_CD AS SLS_UOM_CD,
	CST_SLS_TRN.SLS_ITEM_COST_AMT AS SLS_ITEM_COST_AMT,
	NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0)* CST_DELV_TRN.ACTL_SKU_DELV_QTY AS NET_VAL_AMT_SLS,
	CST_SLS_TRN.SLS_ITEM_SUB_1_AMT AS SLS_ITEM_SUB_1_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_2_AMT AS SLS_ITEM_SUB_2_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_3_AMT AS SLS_ITEM_SUB_3_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_4_AMT AS SLS_ITEM_SUB_4_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_5_AMT AS SLS_ITEM_SUB_5_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_6_AMT AS SLS_ITEM_SUB_6_AMT,
	CST_SLS_TRN.CUST_CLUS_CD AS CUST_CLUS_CD,
	CST_SLS_TRN.CUST_SUB_CLUS_CD AS CUST_SUB_CLUS_CD,
	CST_SLS_TRN.CUST_REGN_MKT_CD AS CUST_REGN_MKT_CD,
	CST_SLS_TRN.CUST_TTL_ENT_CD AS CUST_TTL_ENT_CD,
	CST_SLS_TRN.CUST_RTL_BNR_CD AS CUST_RTL_BNR_CD,
	CST_SLS_TRN.CUST_INDSTR_1_CD AS CUST_INDSTR_1_CD,
	CST_SLS_TRN.CUST_INDSTR_2_CD AS CUST_INDSTR_2_CD,
	CST_SLS_TRN.CUST_INDSTR_3_CD AS CUST_INDSTR_3_CD,
	CST_SLS_TRN.CUST_INDSTR_4_CD AS CUST_INDSTR_4_CD,
	CST_SLS_TRN.CUST_INDSTR_5_CD AS CUST_INDSTR_5_CD,
	CST_SLS_TRN.FISC_MO_SHRT_NM AS FISC_MO_SHRT_NM,
	CST_SLS_TRN.FISC_YR_NBR AS FISC_YR_NBR,
	CST_SLS_TRN.CAL_DAY_SHRT_NM AS CAL_DAY_SHRT_NM,
	CST_SLS_TRN.FISC_WK_NBR AS FISC_WK_NBR,
	CST_SLS_TRN.FISC_QTR_NM AS FISC_QTR_NM,
	CST_SLS_TRN.FISC_MO_STRT_DT AS FISC_MO_STRT_DT,
	CST_SLS_TRN.FISC_MO_END_DT AS FISC_MO_END_DT,
	CST_DELV_TRN.DELV_TYPE_CD AS DELV_TYPE_CD,
	CST_DELV_TRN.DELV_CRT_DTTM AS DELV_CRT_DTTM,
	CST_DELV_TRN.MATL_NUM AS MATL_NUM,
	CST_DELV_TRN.RTE_NUM AS RTE_NUM,
	CST_DELV_TRN.PICK_DTTM AS PICK_DTTM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY AS ACTL_SKU_DELV_QTY,
	CST_DELV_TRN.DELV_BASE_UOM_CD AS DELV_BASE_UOM_CD,
	CST_DELV_TRN.ACTL_SLS_UNIT_DELV_QTY AS ACTL_SLS_UNIT_DELV_QTY,
	CST_DELV_TRN.MATL_SHRT_DESC AS MATL_SHRT_DESC,
	CST_DELV_TRN.GLBL_BRND_DESC AS GLBL_BRND_DESC,
	CST_DELV_TRN.RGN_BRND_DESC AS RGN_BRND_DESC,
	CST_DELV_TRN.RGN_MEGA_BRND_DESC AS RGN_MEGA_BRND_DESC,
	CST_DELV_TRN.PROD_CAT_DESC AS PROD_CAT_DESC,
	CST_DELV_TRN.TRSPN_GRP_CD AS TRSPN_GRP_CD,
	CST_DELV_TRN.RGN_BASE_PROD_DESC AS RGN_BASE_PROD_DESC,
	CST_DELV_TRN.RGN_VRNT_DESC AS RGN_VRNT_DESC,
	CST_DELV_TRN.RGN_PUT_UP_DESC AS RGN_PUT_UP_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_1_DESC AS MATL_GLOBL_HIER_1_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_2_DESC AS MATL_GLOBL_HIER_2_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_3_DESC AS MATL_GLOBL_HIER_3_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_4_DESC AS MATL_GLOBL_HIER_4_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_5_DESC AS MATL_GLOBL_HIER_5_DESC,
	CST_MATL_UOM.GRS_WT_MEAS_PC AS GRS_WT_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS FCTR_NUMRTR_MEAS_CS,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_CS AS FCTR_DNMNTR_MEAS_CS,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PC AS FCTR_NUMRTR_MEAS_PC,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PC AS FCTR_DNMNTR_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS FCTR_NUMRTR_MEAS_PL,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PL AS FCTR_DNMNTR_MEAS_PL,
	CST_MATL_UOM.VOL_MEAS_CS AS VOL_MEAS_CS,
	CST_MATL_UOM.VOL_MEAS_PC AS VOL_MEAS_PC,
	CST_MATL_UOM.VOL_UOM_MEAS AS VOL_UOM_MEAS,
	CST_MATL_UOM.VOL_MEAS_PL AS VOL_MEAS_PL,
	CST_MATL_UOM.CS_PER_PLLT_UOM AS CS_PER_PLLT_UOM,
	CST_TPT_TRN.TRSPN_OTH_COST_AMT AS TRSPN_OTH_COST_AMT,
	CST_TPT_TRN.FUEL_SURC_COST_AMT AS FUEL_SURC_COST_AMT,
	CST_TPT_TRN.MLT_DRP_COST_AMT AS MLT_DRP_COST_AMT,
	CST_TPT_TRN.OVNT_COST_AMT AS OVNT_COST_AMT,
	CST_TPT_TRN.TRAVL_DSTC_COST_AMT AS TRAVL_DSTC_COST_AMT,
	CST_TPT_TRN.UNLD_COST_AMT AS UNLD_COST_AMT,
	CST_TPT_TRN.WAIT_TIME_COST_AMT AS WAIT_TIME_COST_AMT,
	CST_TPT_TRN.WT_AMT_COST AS WT_AMT_COST,
	CST_TPT_TRN.CROS_DK_COST_AMT AS CROS_DK_COST_AMT,
	CST_TPT_TRN.TRSPN_BASE_RT AS TRSPN_BASE_RT,
	CST_TPT_TRN.PER_KM_TRSPN_COST_AMT AS PER_KM_TRSPN_COST_AMT,
	CST_TPT_TRN.UTLZ_LTL_LCL_PCT AS UTLZ_LTL_LCL_PCT,
	CST_TPT_TRN.DELV_DSTC_IN_KM AS DELV_DSTC_IN_KM,
	CST_TPT_TRN.BILL_OF_LDNG AS BILL_OF_LDNG,
	CST_TPT_TRN.SHIP_MODE AS SHIP_MODE,
	CST_TPT_TRN.TRK_MAX_CAPY_CBM AS TRK_MAX_CAPY_CBM,
	CST_TPT_TRN.TRK_MAX_CAPY_KG AS TRK_MAX_CAPY_KG,
	CST_TPT_TRN.GRS_VOL_CBM AS GRS_VOL_CBM,
	CST_TPT_TRN.NET_VOL_CBM AS NET_VOL_CBM,
	CST_TPT_TRN.TRSPN_TYPE_CD AS TRSPN_TYPE_CD,
	CST_TPT_TRN.SHIP_TYPE_CD AS SHIP_TYPE_CD,
	CST_TPT_TRN.NET_WT_QTY AS NET_WT_QTY,
	CST_TPT_TRN.GRS_WT_QTY AS GRS_WT_QTY,
	CST_TPT_TRN.CHRG_MECH_CD AS CHRG_MECH_CD,
	CST_TPT_TRN.RT_CARD_ID AS RT_CARD_ID,
	CST_TPT_TRN.ORIG_CD AS ORIG_CD,
	CST_TPT_TRN.DEST_CD AS DEST_CD,
	CST_TPT_TRN.SNDR_ST_CD AS SNDR_ST_CD,
	CST_TPT_TRN.RCVR_ST_CD AS RCVR_ST_CD,
	CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT AS OUTB_TRSPN_INCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT AS OUTB_TRSPN_EXCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_TAX_AMT AS OUTB_TRSPN_TAX_AMT,
	CST_TPT_TRN.DIST_TRVL_RATE_AMT AS DIST_TRVL_RATE_AMT,
	CST_TPT_TRN.WAIT_TIME_RATE_AMT AS WAIT_TIME_RATE_AMT,
	CST_TPT_TRN.RATE_PER_KG_AMT AS RATE_PER_KG_AMT,
	CST_TPT_TRN.FUEL_SURC_PCT AS FUEL_SURC_PCT,
	CST_TPT_TRN.DELV_VEND_NM AS DELV_VEND_NM,
	CST_TPT_TRN.LANE_ID AS LANE_ID,
	CST_TPT_TRN.CARR_NM AS CARR_NM,
	CST_TPT_TRN.TRK_TYPE_DESC AS TRK_TYPE_DESC,
	CST_TPT_TRN.ACTL_DC_DSPCH_FRM_DTTM AS ACTL_DC_DSPCH_FRM_DTTM,
	CST_TPT_TRN.SHIP_REF_NUM AS SHIP_REF_NUM,
	CST_TPT_TRN.SHIP_PRIR_DESC AS SHIP_PRIR_DESC,
	CST_TPT_TRN.OUTB_EXTRA_COST_AMT AS OUTB_EXTRA_COST_AMT,
	CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT AS OUTB_TPT_VOL_COST_AMT,
	CST_TPT_TRN.DELV_DTTM AS DELV_DTTM,
	CST_WH_TRN.LBR_COST_AMT_PL AS LBR_COST_AMT_PL,
	CST_WH_TRN.LBR_COST_AMT_CS AS LBR_COST_AMT_CS,
	CST_WH_TRN.LBR_COST_AMT_PC AS LBR_COST_AMT_PC,
	CST_WH_TRN.TTL_CUST_SRVC_COST_AMT AS TTL_CUST_SRVC_COST_AMT,
	CST_WH_TRN.FX_COST_AMT AS FX_COST_AMT,
	CST_WH_TRN.STRG_COST_AMT AS STRG_COST_AMT,
	CST_WH_TRN.OTH_COST_AMT AS OTH_COST_AMT,
	CST_WH_TRN.CNSUM_COST_AMT AS CNSUM_COST_AMT,
	CST_WH_TRN.OUTB_HNDG_COST_AMT AS OUTB_HNDG_COST_AMT,
	CST_WH_TRN.TTL_WH_COST_AMT AS TTL_WH_COST_AMT,
	CASE
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PC', 'EA') THEN CST_SLS_TRN.SLS_ORDR_QTY
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL)
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS)
	ELSE 0
	END AS SLS_ORDR_QTY_PC,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS SLS_ORDR_QTY_CASE,
	CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC AS SLS_ORDR_QTY_PC_CBM,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS SLS_ORDR_QTY_PLLT,
	CASE
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PC', 'EA') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS
	ELSE 0
	END AS ACTL_DELV_QTY_PC,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS ACTL_DELV_QTY_CASE,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.VOL_MEAS_PC AS ACTL_DELV_QTY_PC_CBM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS ACTL_DELV_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT AS PICK_PACK_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_CASE AS PICK_PACK_QTY_CASE,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PC AS PICK_PACK_QTY_PC,
	(NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT, 0)) AS TTL_DELV_COST_AMT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC)) AS TTL_DELV_COST_AMT_CBM,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL) AS TTL_DELV_COST_AMT_PLLT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS) AS TTL_DELV_COST_AMT_CASE,
	CST_SLS_TRN.LCL_CRNCY_CD AS LCL_CRNCY_CD,
	CST_SLS_TRN.SLS_ITEM_COST_AMT AS SLS_ITEM_COST_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_1_AMT AS SLS_ITEM_SUB_1_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_2_AMT AS SLS_ITEM_SUB_2_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_3_AMT AS SLS_ITEM_SUB_3_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_4_AMT AS SLS_ITEM_SUB_4_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_5_AMT AS SLS_ITEM_SUB_5_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_6_AMT AS SLS_ITEM_SUB_6_USD_AMT,
	(NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0)* CST_DELV_TRN.ACTL_SKU_DELV_QTY) AS NET_VAL_USD_AMT_SLS,
	CST_WH_TRN.CNSUM_COST_AMT AS CNSUM_COST_USD_AMT,
	CST_WH_TRN.FX_COST_AMT AS FX_COST_USD_AMT,
	CST_WH_TRN.OTH_COST_AMT AS OTH_COST_USD_AMT,
	CST_WH_TRN.OUTB_HNDG_COST_AMT AS OUTB_HNDG_COST_USD_AMT,
	CST_WH_TRN.LBR_COST_AMT_PL AS LBR_COST_USD_AMT_PL,
	CST_WH_TRN.LBR_COST_AMT_CS AS LBR_COST_USD_AMT_CS,
	CST_WH_TRN.STRG_COST_AMT AS STRG_COST_USD_AMT,
	CST_WH_TRN.TTL_CUST_SRVC_COST_AMT AS TTL_CUST_SRVC_COST_USD_AMT,
	CST_WH_TRN.LBR_COST_AMT_PC AS LBR_COST_USD_AMT_PC,
	CST_WH_TRN.TTL_WH_COST_AMT AS TTL_WH_COST_USD_AMT,
	CST_TPT_TRN.CROS_DK_COST_AMT AS CROS_DK_COST_USD_AMT,
	CST_TPT_TRN.FUEL_SURC_COST_AMT AS FUEL_SURC_COST_USD_AMT,
	CST_TPT_TRN.MLT_DRP_COST_AMT AS MLT_DRP_COST_USD_AMT,
	CST_TPT_TRN.OUTB_EXTRA_COST_AMT AS OUTB_EXTRA_COST_USD_AMT,
	CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT AS OUTB_TPT_VOL_COST_USD_AMT,
	CST_TPT_TRN.OVNT_COST_AMT AS OVNT_COST_USD_AMT,
	CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT AS OUTB_TRSN_EXCL_TAX_CST_USD_AMT,
	CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT AS OUTB_TRSN_INCL_TAX_CST_USD_AMT,
	CST_TPT_TRN.OUTB_TRSPN_TAX_AMT AS OUTB_TRSN_TAX_USD_AMT,
    CST_TPT_TRN.TRSPN_BASE_RT AS TRSPN_BASE_RT_USD_AMT,
    CST_TPT_TRN.PER_KM_TRSPN_COST_AMT AS PER_KM_TRSPN_COST_USD_AMT,
    CST_TPT_TRN.TRSPN_OTH_COST_AMT AS TRSPN_OTH_COST_USD_AMT,
    CST_TPT_TRN.TRAVL_DSTC_COST_AMT AS TRAVL_DSTC_COST_USD_AMT,
    CST_TPT_TRN.UNLD_COST_AMT AS UNLD_COST_USD_AMT,
    CST_TPT_TRN.WAIT_TIME_COST_AMT AS WAIT_TIME_COST_USD_AMT,
    CST_TPT_TRN.WAIT_TIME_RATE_AMT AS WAIT_TIME_RATE_USD_AMT,
    CST_TPT_TRN.WT_AMT_COST AS WT_AMT_COST_USD,
    CST_TPT_TRN.DIST_TRVL_RATE_AMT AS DIST_TRVL_RATE_USD_AMT,
    CST_TPT_TRN.RATE_PER_KG_AMT AS RATE_PER_KG_USD_AMT,
    (NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT, 0)) AS TTL_DELV_COST_USD_AMT,
    (NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC)) AS TTL_DELV_COST_USD_AMT_CBM,
    ((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL) AS TTL_DELV_COST_USD_AMT_PLLT,
    ((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS) AS TTL_DELV_COST_USD_AMT_CASE,
	CST_SLS_TRN.SLS_ORDR_GEN_NM AS SLS_ORDR_GEN_NM,
	CST_SLS_TRN.REGION_INC AS REGION_INC,
	CST_SLS_TRN.LINE_ITEM_CAT_CD AS LINE_ITEM_CAT_CD,
	CST_DELV_TRN.ACTL_GI_DT AS ACTL_GI_DT,
	'' AS OUT_OF_SRVC_IND,
	CST_SLS_TRN.KEY_CUST_NM AS KEY_CUST_NM,
	CST_SLS_TRN.KEY_CUST_NUM AS KEY_CUST_NUM,
	CST_TPT_TRN.LD_NUM AS LD_NUM,
	CST_TPT_TRN.PLAN_GI_DT AS PLAN_GI_DT,
	CST_TPT_TRN.INVC_CRT_DT AS INVC_CRT_DT,
	CST_TPT_TRN.SLS_INVC_NUM AS SLS_INVC_NUM,
	CST_TPT_TRN.PO_NUM AS PO_NUM,
	CST_TPT_TRN.CARR_CD AS CARR_CD,
	CST_TPT_TRN.CMMDTY_CD AS CMMDTY_CD,
	CST_TPT_TRN.CARR_PRO_NUM AS CARR_PRO_NUM,
	CST_TPT_TRN.TMS_MATCH_IND AS TMS_MATCH_IND,
    CST_TPT_TRN.FRGHT_MATCH_IND AS FRGHT_MATCH_IND,
	CST_TPT_TRN.EST_FUEL_SURC_AMT AS EST_FUEL_SURC_AMT,
	CST_TPT_TRN.TOT_ACCSORIAL_PD_AMT AS TOT_ACCSORIAL_PD_AMT,
	CST_TPT_TRN.TOT_FRGHT_CHRG_AMT AS TOT_FRGHT_CHRG_AMT,
	CST_TPT_TRN.TOT_PLAN_COST_AMT AS TOT_PLAN_COST_AMT,
	CST_TPT_TRN.EST_ACTL_DIFF_COST_AMT AS EST_ACTL_DIFF_COST_AMT,
	CST_TPT_TRN.GRS_WT_MEAS AS GRS_WT_MEAS,
	CST_TPT_TRN.INVC_LINE_ITEM_VOL_MEAS AS INVC_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.GRS_WT_ITM_QTY AS GRS_WT_ITM_QTY,
	CST_TPT_TRN.SLS_LINE_ITEM_VOL_MEAS AS SLS_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.PLNT_ADDR_NUM AS PLNT_ADDR_NUM,
	CST_TPT_TRN.SHIP_COND_CD AS SHIP_COND_CD,
	NULL AS NTWK_SHIP_TO_NM,
	CST_TPT_TRN.INVC_CNT AS INVC_CNT,
	CST_TPT_TRN.SLS_CNFRM_CASE_QTY AS SLS_CNFRM_CASE_QTY,
	CST_TPT_TRN.CUST_UNIT_SLS_CNFRM_QTY AS CUST_UNIT_SLS_CNFRM_QTY,
	CST_TPT_TRN.SLS_CNFRM_EA_QTY AS SLS_CNFRM_EA_QTY,
	CST_TPT_TRN.INVC_EA_QTY AS INVC_EA_QTY,
	CST_TPT_TRN.INVC_CASE_QTY AS INVC_CASE_QTY,
	CST_TPT_TRN.SLS_ORDR_CASE_QTY AS SLS_ORDR_CASE_QTY,
	CST_TPT_TRN.SNGL_SRC_MATL_IND AS SNGL_SRC_MATL_IND,
	CST_TPT_TRN.PMT_SYS_DTTM AS PMT_SYS_DTTM,
	NULL AS CROSSDK_WT_BAS_COST_AMT,
	NULL AS FUEL_SURC_WT_BAS_COST_AMT,
	NULL AS MULTIDROP_WT_BAS_COST_AMT,
	NULL AS OUTB_WT_BAS_COST_EXTRA_AMT,
	NULL AS OVNT_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_COST_TAX_AMT,
	NULL AS TRNSP_WT_BAS_COST_INC_TAX_AMT,
	NULL AS TRNSP_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_BASE_RT_AMT,
	NULL AS TRNSP_WT_BAS_OTH_COST_AMT,
	NULL AS UNLDING_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_COST_EXCL_TAX_AMT,
	NULL AS WAIT_TIME_BAS_COST_AMT,
	NULL AS WT_AMT_COST_AMT,
	NULL AS TRAVL_DSTC_BAS_COST_AMT,
	NULL AS UNLD_COST_USD_WT_BAS_AMT,
	NULL AS CROSSDK_COST_USD_WT_BAS_AMT,
	NULL AS FUEL_SURC_COST_USD_WT_BAS_AMT,
	NULL AS MULTIDROP_COST_USD_WT_BAS_AMT,
	NULL AS OVNT_COST_USD_WT_BASE_AMT,
	NULL AS OUTB_EXCL_TAX_USD_WT_BAS_AMT,
	NULL AS OUTB_INCL_TAX_USD_WT_BAS_AMT,
	NULL AS OUTB_TRNSP_TAX_USD_WT_BAS_AMT,
	NULL AS TRNSP_BASE_RT_USD_WT_BAS_AMT,
	NULL AS TRNSP_OTH_COST_USD_WT_BAS_AMT,
	NULL AS TRAVL_DSTC_COST_USD_WT_BAS_AMT,
	NULL AS WAIT_TIME_COST_USD_WT_BAS_AMT,
	NULL AS WT_AMT_COST_WT_BAS_AMT,
	NULL AS OUTB_EXTRA_COST_USD_WT_BAS_AMT,
	NULL AS EST_WT_BAS_FUEL_SURC_AMT,
	NULL AS TOT_ACCSORIAL_PD_WT_BAS_AMT,
	NULL AS TOT_FRGHT_CHRG_WT_BAS_AMT,
	NULL AS TOT_PLAN_WT_BAS_COST_AMT,
	CST_SLS_TRN.ORIG_RQST_DELV_DT AS ORIG_RQST_DELV_DT,
	CST_SLS_TRN.RQST_DELV_DT AS RQST_DELV_DT,
	CST_TPT_TRN.PRC_PCDR1_AMT AS PRC_PCDR1_AMT,
	CST_TPT_TRN.BRND_DESC AS BRND_DESC,
	CST_TPT_TRN.GBU_DESC AS GBU_DESC,
	CST_TPT_TRN.FRAN_DESC AS FRAN_DESC,
	CST_TPT_TRN.MATL_RGM_CLSN_CD AS MATL_RGM_CLSN_CD,
	CST_TPT_TRN.FISC_CUR_MO_IND AS FISC_CUR_MO_IND,
	CST_TPT_TRN.REL_TO_TDY_FISC_MO_CNT AS REL_TO_TDY_FISC_MO_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_QTR_CNT AS REL_TO_TDY_FISC_QTR_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_YR_CNT AS REL_TO_TDY_FISC_YR_CNT,
	CST_TPT_TRN.CAL_DT AS CAL_DT,
	CST_TPT_TRN.FISC_QTR_STRT_DT AS FISC_QTR_STRT_DT,
	CST_TPT_TRN.FISC_QE_DT AS FISC_QE_DT,
	CST_TPT_TRN.FISC_WK_STRT_DT AS FISC_WK_STRT_DT,
	CST_TPT_TRN.FISC_WK_END_DT AS FISC_WK_END_DT,
	'' AS NON_CMPNT_IND,
	NULL AS CUST_SEG_CD,
	'SRC_SYS_CD|^DELV_NUM|^DELV_LINE_NBR|^SLS_ORDR_NUM|^SLS_ORDR_LINE_NBR' AS LOGL_KEY_CMBN_COL_NM,
	CONCAT(CST_DELV_TRN.SRC_SYS_CD, '|^', CST_DELV_TRN.DELV_NUM, '|^', CST_DELV_TRN.DELV_LINE_NBR, '|^', CST_SLS_TRN.SLS_ORDR_NUM, '|^', CST_SLS_TRN.SLS_ORDR_LINE_NBR) AS LOGL_KEY_CMBN_COL_VAL,
	CAST(CURRENT_TIMESTAMP() AS BIGINT) AS DAI_BTCH_ID,
	CURRENT_TIMESTAMP() AS DAI_UPDT_DTTM,
	CURRENT_TIMESTAMP() AS DAI_CRT_DTTM,
	CST_DELV_TRN.SRC_SYS_CD AS SRC_SYS_CD,
	CST_DELV_TRN.CRT_YR_NBR AS CRT_YR_NBR,
	CST_DELV_TRN.CRT_MO_NBR AS CRT_MO_NBR
FROM DELV.CST_DELV_TRN
INNER JOIN DELV.CST_SLS_TRN ON CST_DELV_TRN.DELV_NUM = CST_SLS_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_SLS_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_SLS_TRN.SRC_SYS_CD
INNER JOIN DELIV_FILES.COUNTRY_INC ON CST_DELV_TRN.SRC_SYS_CD = COUNTRY_INC.SRC_SYS_CD AND CST_SLS_TRN.PLNT_CTRY_CD = COUNTRY_INC.PLNT_CTRY_CD
LEFT OUTER JOIN DELV.CST_MATL_UOM ON CST_DELV_TRN.DELV_NUM = CST_MATL_UOM.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_MATL_UOM.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_MATL_UOM.SRC_SYS_CD
LEFT OUTER JOIN DELV.CST_TPT_TRN ON CST_DELV_TRN.DELV_NUM = CST_TPT_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_TPT_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_TPT_TRN.SRC_SYS_CD
LEFT OUTER JOIN DELV.CST_WH_TRN ON CST_DELV_TRN.DELV_NUM = CST_WH_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_WH_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_WH_TRN.SRC_SYS_CD
LEFT OUTER JOIN SC_CORE.MATL_ALT_UOM ON MATL_ALT_UOM.MATL_NUM = CST_MATL_UOM.MATL_NUM AND cst_sls_trn.ORDR_BASE_UOM_CD = matl_alt_uom.matl_alt_uom_cd AND CST_DELV_TRN.SRC_SYS_CD = MATL_ALT_UOM.SRC_SYS_CD
WHERE CST_SLS_TRN.SRC_SYS_CD IN ('BBN','1S4') AND CST_DELV_TRN.ACTL_SKU_DELV_QTY > 0 AND UPPER(COUNTRY_INC.COUNTRY_INC) ='YES'

UNION ALL

--Below query is generated from : Supply_Chain/Deliver/CostToDeliver_Final_Transaction_CLA.csv
SELECT DISTINCT
	CST_DELV_TRN.DELV_NUM AS DELV_NUM,
	CST_DELV_TRN.DELV_LINE_NBR AS DELV_LINE_NBR,
	CST_DELV_TRN.SLS_ORDR_NUM AS SLS_ORDR_NUM,
	CST_DELV_TRN.SLS_ORDR_LINE_NBR AS SLS_ORDR_LINE_NBR,
	CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS SLS_ORDR_CRT_DTTM,
	CST_SLS_TRN.SLS_ORDR_TYPE_CD AS SLS_ORDR_TYPE_CD,
	CST_SLS_TRN.SLS_ORDR_TYPE_DESC AS SLS_ORDR_TYPE_DESC,
	CST_SLS_TRN.PLNT_CD AS PLNT_CD,
	CST_SLS_TRN.PLNT_NM AS PLNT_NM,
	CST_SLS_TRN.PLNT_CITY_NM AS PLNT_CITY_NM,
	CST_SLS_TRN.PLNT_CTRY_CD AS PLNT_CTRY_CD,
	CST_SLS_TRN.PLNT_PSTL_CD_NUM AS PLNT_PSTL_CD_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NUM AS SOLD_TO_CUST_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NM AS SOLD_TO_CUST_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CITY_NM AS SOLD_TO_CUST_CITY_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CTRY_CD AS SOLD_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SOLD_TO_ST_PRVNC_CD AS SOLD_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SOLD_TO_CUST_PSTL_NUM AS SOLD_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NUM AS SHIP_TO_CUST_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NM AS SHIP_TO_CUST_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CITY_NM AS SHIP_TO_CUST_CITY_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CTRY_CD AS SHIP_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SHIP_TO_ST_PRVNC_CD AS SHIP_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SHIP_TO_CUST_PSTL_NUM AS SHIP_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.CUST_PO_TYPE_CD AS CUST_PO_TYPE_CD,
	CST_SLS_TRN.CUST_PO_TYPE_DESC AS CUST_PO_TYPE_DESC,
	CST_SLS_TRN.SLORG_NUM AS SLORG_NUM,
	CST_SLS_TRN.DSTR_CHNL_CD AS DSTR_CHNL_CD,
	CST_SLS_TRN.DSTR_CHNL_DESC AS DSTR_CHNL_DESC,
	CST_SLS_TRN.SLS_ORDR_QTY AS SLS_ORDR_QTY,
	CST_SLS_TRN.ORDR_BASE_UOM_CD AS ORDR_BASE_UOM_CD,
	CST_SLS_TRN.SLS_UOM_ORDR_QTY AS SLS_UOM_ORDR_QTY,
	CST_SLS_TRN.SLS_UOM_CD AS SLS_UOM_CD,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE*CST_SLS_TRN.SLS_ITEM_COST_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_COST_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE*(NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0)* CST_DELV_TRN.ACTL_SKU_DELV_QTY))/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS NET_VAL_AMT_SLS,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE*CST_SLS_TRN.SLS_ITEM_SUB_1_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_1_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE*CST_SLS_TRN.SLS_ITEM_SUB_2_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_2_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE*CST_SLS_TRN.SLS_ITEM_SUB_3_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_3_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE*CST_SLS_TRN.SLS_ITEM_SUB_4_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_4_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE*CST_SLS_TRN.SLS_ITEM_SUB_5_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_5_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE*CST_SLS_TRN.SLS_ITEM_SUB_6_AMT)/CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE AS SLS_ITEM_SUB_6_AMT,
	CST_SLS_TRN.CUST_CLUS_CD AS CUST_CLUS_CD,
	CST_SLS_TRN.CUST_SUB_CLUS_CD AS CUST_SUB_CLUS_CD,
	CST_SLS_TRN.CUST_REGN_MKT_CD AS CUST_REGN_MKT_CD,
	CST_SLS_TRN.CUST_TTL_ENT_CD AS CUST_TTL_ENT_CD,
	CST_SLS_TRN.CUST_RTL_BNR_CD AS CUST_RTL_BNR_CD,
	CST_SLS_TRN.CUST_INDSTR_1_CD AS CUST_INDSTR_1_CD,
	CST_SLS_TRN.CUST_INDSTR_2_CD AS CUST_INDSTR_2_CD,
	CST_SLS_TRN.CUST_INDSTR_3_CD AS CUST_INDSTR_3_CD,
	CST_SLS_TRN.CUST_INDSTR_4_CD AS CUST_INDSTR_4_CD,
	CST_SLS_TRN.CUST_INDSTR_5_CD AS CUST_INDSTR_5_CD,
	CST_SLS_TRN.FISC_MO_SHRT_NM AS FISC_MO_SHRT_NM,
	CST_SLS_TRN.FISC_YR_NBR AS FISC_YR_NBR,
	CST_SLS_TRN.CAL_DAY_SHRT_NM AS CAL_DAY_SHRT_NM,
	CST_SLS_TRN.FISC_WK_NBR AS FISC_WK_NBR,
	CST_SLS_TRN.FISC_QTR_NM AS FISC_QTR_NM,
	CST_SLS_TRN.FISC_MO_STRT_DT AS FISC_MO_STRT_DT,
	CST_SLS_TRN.FISC_MO_END_DT AS FISC_MO_END_DT,
	CST_DELV_TRN.DELV_TYPE_CD AS DELV_TYPE_CD,
	CST_DELV_TRN.DELV_CRT_DTTM AS DELV_CRT_DTTM,
	CST_DELV_TRN.MATL_NUM AS MATL_NUM,
	CST_DELV_TRN.RTE_NUM AS RTE_NUM,
	CST_DELV_TRN.PICK_DTTM AS PICK_DTTM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY AS ACTL_SKU_DELV_QTY,
	CST_DELV_TRN.DELV_BASE_UOM_CD AS DELV_BASE_UOM_CD,
	CST_DELV_TRN.ACTL_SLS_UNIT_DELV_QTY AS ACTL_SLS_UNIT_DELV_QTY,
	CST_DELV_TRN.MATL_SHRT_DESC AS MATL_SHRT_DESC,
	CST_DELV_TRN.GLBL_BRND_DESC AS GLBL_BRND_DESC,
	CST_DELV_TRN.RGN_BRND_DESC AS RGN_BRND_DESC,
	CST_DELV_TRN.RGN_MEGA_BRND_DESC AS RGN_MEGA_BRND_DESC,
	CST_DELV_TRN.PROD_CAT_DESC AS PROD_CAT_DESC,
	CST_DELV_TRN.TRSPN_GRP_CD AS TRSPN_GRP_CD,
	CST_DELV_TRN.RGN_BASE_PROD_DESC AS RGN_BASE_PROD_DESC,
	CST_DELV_TRN.RGN_VRNT_DESC AS RGN_VRNT_DESC,
	CST_DELV_TRN.RGN_PUT_UP_DESC AS RGN_PUT_UP_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_1_DESC AS MATL_GLOBL_HIER_1_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_2_DESC AS MATL_GLOBL_HIER_2_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_3_DESC AS MATL_GLOBL_HIER_3_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_4_DESC AS MATL_GLOBL_HIER_4_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_5_DESC AS MATL_GLOBL_HIER_5_DESC,
	CST_MATL_UOM.GRS_WT_MEAS_PC AS GRS_WT_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS FCTR_NUMRTR_MEAS_CS,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_CS AS FCTR_DNMNTR_MEAS_CS,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PC AS FCTR_NUMRTR_MEAS_PC,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PC AS FCTR_DNMNTR_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS FCTR_NUMRTR_MEAS_PL,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PL AS FCTR_DNMNTR_MEAS_PL,
	CST_MATL_UOM.VOL_MEAS_CS AS VOL_MEAS_CS,
	CST_MATL_UOM.VOL_MEAS_PC AS VOL_MEAS_PC,
	CST_MATL_UOM.VOL_UOM_MEAS AS VOL_UOM_MEAS,
	CST_MATL_UOM.VOL_MEAS_PL AS VOL_MEAS_PL,
	CST_MATL_UOM.CS_PER_PLLT_UOM AS CS_PER_PLLT_UOM,
	CST_TPT_TRN.TRSPN_OTH_COST_AMT AS TRSPN_OTH_COST_AMT,
	CST_TPT_TRN.FUEL_SURC_COST_AMT AS FUEL_SURC_COST_AMT,
	CST_TPT_TRN.MLT_DRP_COST_AMT AS MLT_DRP_COST_AMT,
	CST_TPT_TRN.OVNT_COST_AMT AS OVNT_COST_AMT,
	CST_TPT_TRN.TRAVL_DSTC_COST_AMT AS TRAVL_DSTC_COST_AMT,
	CST_TPT_TRN.UNLD_COST_AMT AS UNLD_COST_AMT,
	CST_TPT_TRN.WAIT_TIME_COST_AMT AS WAIT_TIME_COST_AMT,
	CST_TPT_TRN.WT_AMT_COST AS WT_AMT_COST,
	CST_TPT_TRN.CROS_DK_COST_AMT AS CROS_DK_COST_AMT,
	CST_TPT_TRN.TRSPN_BASE_RT AS TRSPN_BASE_RT,
	CST_TPT_TRN.PER_KM_TRSPN_COST_AMT AS PER_KM_TRSPN_COST_AMT,
	CST_TPT_TRN.UTLZ_LTL_LCL_PCT AS UTLZ_LTL_LCL_PCT,
	CST_TPT_TRN.DELV_DSTC_IN_KM AS DELV_DSTC_IN_KM,
	CST_TPT_TRN.BILL_OF_LDNG AS BILL_OF_LDNG,
	CST_TPT_TRN.SHIP_MODE AS SHIP_MODE,
	CST_TPT_TRN.TRK_MAX_CAPY_CBM AS TRK_MAX_CAPY_CBM,
	CST_TPT_TRN.TRK_MAX_CAPY_KG AS TRK_MAX_CAPY_KG,
	CST_TPT_TRN.GRS_VOL_CBM AS GRS_VOL_CBM,
	CST_TPT_TRN.NET_VOL_CBM AS NET_VOL_CBM,
	CST_TPT_TRN.TRSPN_TYPE_CD AS TRSPN_TYPE_CD,
	CST_TPT_TRN.SHIP_TYPE_CD AS SHIP_TYPE_CD,
	CST_TPT_TRN.NET_WT_QTY AS NET_WT_QTY,
	CST_TPT_TRN.GRS_WT_QTY AS GRS_WT_QTY,
	CST_TPT_TRN.CHRG_MECH_CD AS CHRG_MECH_CD,
	CST_TPT_TRN.RT_CARD_ID AS RT_CARD_ID,
	CST_TPT_TRN.ORIG_CD AS ORIG_CD,
	CST_TPT_TRN.DEST_CD AS DEST_CD,
	CST_TPT_TRN.SNDR_ST_CD AS SNDR_ST_CD,
	CST_TPT_TRN.RCVR_ST_CD AS RCVR_ST_CD,
	CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT AS OUTB_TRSPN_INCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT AS OUTB_TRSPN_EXCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_TAX_AMT AS OUTB_TRSPN_TAX_AMT,
	CST_TPT_TRN.DIST_TRVL_RATE_AMT AS DIST_TRVL_RATE_AMT,
	CST_TPT_TRN.WAIT_TIME_RATE_AMT AS WAIT_TIME_RATE_AMT,
	CST_TPT_TRN.RATE_PER_KG_AMT AS RATE_PER_KG_AMT,
	CST_TPT_TRN.FUEL_SURC_PCT AS FUEL_SURC_PCT,
	CST_TPT_TRN.DELV_VEND_NM AS DELV_VEND_NM,
	CST_TPT_TRN.LANE_ID AS LANE_ID,
	CST_TPT_TRN.CARR_NM AS CARR_NM,
	CST_TPT_TRN.TRK_TYPE_DESC AS TRK_TYPE_DESC,
	CST_TPT_TRN.ACTL_DC_DSPCH_FRM_DTTM AS ACTL_DC_DSPCH_FRM_DTTM,
	CST_TPT_TRN.SHIP_REF_NUM AS SHIP_REF_NUM,
	CST_TPT_TRN.SHIP_PRIR_DESC AS SHIP_PRIR_DESC,
	CST_TPT_TRN.OUTB_EXTRA_COST_AMT AS OUTB_EXTRA_COST_AMT,
	CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT AS OUTB_TPT_VOL_COST_AMT,
	CST_TPT_TRN.DELV_DTTM AS DELV_DTTM,
	CST_WH_TRN.LBR_COST_AMT_PL AS LBR_COST_AMT_PL,
	CST_WH_TRN.LBR_COST_AMT_CS AS LBR_COST_AMT_CS,
	CST_WH_TRN.LBR_COST_AMT_PC AS LBR_COST_AMT_PC,
	CST_WH_TRN.TTL_CUST_SRVC_COST_AMT AS TTL_CUST_SRVC_COST_AMT,
	CST_WH_TRN.FX_COST_AMT AS FX_COST_AMT,
	CST_WH_TRN.STRG_COST_AMT AS STRG_COST_AMT,
	CST_WH_TRN.OTH_COST_AMT AS OTH_COST_AMT,
	CST_WH_TRN.CNSUM_COST_AMT AS CNSUM_COST_AMT,
	CST_WH_TRN.OUTB_HNDG_COST_AMT AS OUTB_HNDG_COST_AMT,
	CST_WH_TRN.TTL_WH_COST_AMT AS TTL_WH_COST_AMT,
	CASE
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PC', 'EA') THEN CST_SLS_TRN.SLS_ORDR_QTY
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL)
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS)
	ELSE 0
	END AS SLS_ORDR_QTY_PC,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS SLS_ORDR_QTY_CASE,
	CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC AS SLS_ORDR_QTY_PC_CBM,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS SLS_ORDR_QTY_PLLT,
	CASE
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PC', 'EA') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS
	ELSE 0
	END AS ACTL_DELV_QTY_PC,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS ACTL_DELV_QTY_CASE,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.VOL_MEAS_PC AS ACTL_DELV_QTY_PC_CBM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS ACTL_DELV_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT AS PICK_PACK_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_CASE AS PICK_PACK_QTY_CASE,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PC AS PICK_PACK_QTY_PC,
	(NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT, 0)) AS TTL_DELV_COST_AMT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC)) AS TTL_DELV_COST_AMT_CBM,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL) AS TTL_DELV_COST_AMT_PLLT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS) AS TTL_DELV_COST_AMT_CASE,
	CST_SLS_TRN.LCL_CRNCY_CD AS LCL_CRNCY_CD,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_COST_AMT) AS SLS_ITEM_COST_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_1_AMT) AS SLS_ITEM_SUB_1_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_2_AMT) AS SLS_ITEM_SUB_2_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_3_AMT) AS SLS_ITEM_SUB_3_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_4_AMT) AS SLS_ITEM_SUB_4_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_5_AMT) AS SLS_ITEM_SUB_5_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_6_AMT) AS SLS_ITEM_SUB_6_USD_AMT,
	(CURRENCY_RATE_1.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0)* CST_DELV_TRN.ACTL_SKU_DELV_QTY)) AS NET_VAL_USD_AMT_SLS,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.CNSUM_COST_AMT) AS CNSUM_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.FX_COST_AMT) AS FX_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.OTH_COST_AMT) AS OTH_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.OUTB_HNDG_COST_AMT) AS OUTB_HNDG_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.LBR_COST_AMT_PL) AS LBR_COST_USD_AMT_PL,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.LBR_COST_AMT_CS) AS LBR_COST_USD_AMT_CS,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.STRG_COST_AMT) AS STRG_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.TTL_CUST_SRVC_COST_AMT) AS TTL_CUST_SRVC_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.LBR_COST_AMT_PC) AS LBR_COST_USD_AMT_PC,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.TTL_WH_COST_AMT) AS TTL_WH_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.CROS_DK_COST_AMT) AS CROS_DK_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.FUEL_SURC_COST_AMT) AS FUEL_SURC_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.MLT_DRP_COST_AMT) AS MLT_DRP_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_EXTRA_COST_AMT) AS OUTB_EXTRA_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT) AS OUTB_TPT_VOL_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OVNT_COST_AMT) AS OVNT_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT) AS OUTB_TRSN_EXCL_TAX_CST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT) AS OUTB_TRSN_INCL_TAX_CST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TRSPN_TAX_AMT) AS OUTB_TRSN_TAX_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.TRSPN_BASE_RT) AS TRSPN_BASE_RT_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.PER_KM_TRSPN_COST_AMT) AS PER_KM_TRSPN_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.TRSPN_OTH_COST_AMT) AS TRSPN_OTH_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.TRAVL_DSTC_COST_AMT) AS TRAVL_DSTC_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.UNLD_COST_AMT) AS UNLD_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.WAIT_TIME_COST_AMT) AS WAIT_TIME_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.WAIT_TIME_RATE_AMT) AS WAIT_TIME_RATE_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.WT_AMT_COST) AS WT_AMT_COST_USD,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.DIST_TRVL_RATE_AMT) AS DIST_TRVL_RATE_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.RATE_PER_KG_AMT) AS RATE_PER_KG_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT, 0))) AS TTL_DELV_COST_USD_AMT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC))) AS TTL_DELV_COST_USD_AMT_CBM,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * ((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL)) AS TTL_DELV_COST_USD_AMT_PLLT,
	(CURRENCY_RATE_2.SOURCE_TO_TARGET_CURRENCY_RATE * ((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS)) AS TTL_DELV_COST_USD_AMT_CASE,
	CST_SLS_TRN.SLS_ORDR_GEN_NM AS SLS_ORDR_GEN_NM,
	CST_SLS_TRN.REGION_INC AS REGION_INC,
	CST_SLS_TRN.LINE_ITEM_CAT_CD AS LINE_ITEM_CAT_CD,
	CST_DELV_TRN.ACTL_GI_DT AS ACTL_GI_DT,
	'' AS OUT_OF_SRVC_IND,
	CST_SLS_TRN.KEY_CUST_NM AS KEY_CUST_NM,
	CST_SLS_TRN.KEY_CUST_NUM AS KEY_CUST_NUM,
	CST_TPT_TRN.LD_NUM AS LD_NUM,
	CST_TPT_TRN.PLAN_GI_DT AS PLAN_GI_DT,
	CST_TPT_TRN.INVC_CRT_DT AS INVC_CRT_DT,
	CST_TPT_TRN.SLS_INVC_NUM AS SLS_INVC_NUM,
	CST_TPT_TRN.PO_NUM AS PO_NUM,
	CST_TPT_TRN.CARR_CD AS CARR_CD,
	CST_TPT_TRN.CMMDTY_CD AS CMMDTY_CD,
	CST_TPT_TRN.CARR_PRO_NUM AS CARR_PRO_NUM,
	CST_TPT_TRN.TMS_MATCH_IND AS TMS_MATCH_IND,
    CST_TPT_TRN.FRGHT_MATCH_IND AS FRGHT_MATCH_IND,
	CST_TPT_TRN.EST_FUEL_SURC_AMT AS EST_FUEL_SURC_AMT,
	CST_TPT_TRN.TOT_ACCSORIAL_PD_AMT AS TOT_ACCSORIAL_PD_AMT,
	CST_TPT_TRN.TOT_FRGHT_CHRG_AMT AS TOT_FRGHT_CHRG_AMT,
	CST_TPT_TRN.TOT_PLAN_COST_AMT AS TOT_PLAN_COST_AMT,
	CST_TPT_TRN.EST_ACTL_DIFF_COST_AMT AS EST_ACTL_DIFF_COST_AMT,
	CST_TPT_TRN.GRS_WT_MEAS AS GRS_WT_MEAS,
	CST_TPT_TRN.INVC_LINE_ITEM_VOL_MEAS AS INVC_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.GRS_WT_ITM_QTY AS GRS_WT_ITM_QTY,
	CST_TPT_TRN.SLS_LINE_ITEM_VOL_MEAS AS SLS_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.PLNT_ADDR_NUM AS PLNT_ADDR_NUM,
	CST_TPT_TRN.SHIP_COND_CD AS SHIP_COND_CD,
	NULL AS NTWK_SHIP_TO_NM,
	CST_TPT_TRN.INVC_CNT AS INVC_CNT,
	CST_TPT_TRN.SLS_CNFRM_CASE_QTY AS SLS_CNFRM_CASE_QTY,
	CST_TPT_TRN.CUST_UNIT_SLS_CNFRM_QTY AS CUST_UNIT_SLS_CNFRM_QTY,
	CST_TPT_TRN.SLS_CNFRM_EA_QTY AS SLS_CNFRM_EA_QTY,
	CST_TPT_TRN.INVC_EA_QTY AS INVC_EA_QTY,
	CST_TPT_TRN.INVC_CASE_QTY AS INVC_CASE_QTY,
	CST_TPT_TRN.SLS_ORDR_CASE_QTY AS SLS_ORDR_CASE_QTY,
	CST_TPT_TRN.SNGL_SRC_MATL_IND AS SNGL_SRC_MATL_IND,
	CST_TPT_TRN.PMT_SYS_DTTM AS PMT_SYS_DTTM,
	NULL AS CROSSDK_WT_BAS_COST_AMT,
	NULL AS FUEL_SURC_WT_BAS_COST_AMT,
	NULL AS MULTIDROP_WT_BAS_COST_AMT,
	NULL AS OUTB_WT_BAS_COST_EXTRA_AMT,
	NULL AS OVNT_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_COST_TAX_AMT,
	NULL AS TRNSP_WT_BAS_COST_INC_TAX_AMT,
	NULL AS TRNSP_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_BASE_RT_AMT,
	NULL AS TRNSP_WT_BAS_OTH_COST_AMT,
	NULL AS UNLDING_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_COST_EXCL_TAX_AMT,
	NULL AS WAIT_TIME_BAS_COST_AMT,
	NULL AS WT_AMT_COST_AMT,
	NULL AS TRAVL_DSTC_BAS_COST_AMT,
	NULL AS UNLD_COST_USD_WT_BAS_AMT,
	NULL AS CROSSDK_COST_USD_WT_BAS_AMT,
	NULL AS FUEL_SURC_COST_USD_WT_BAS_AMT,
	NULL AS MULTIDROP_COST_USD_WT_BAS_AMT,
	NULL AS OVNT_COST_USD_WT_BASE_AMT,
	NULL AS OUTB_EXCL_TAX_USD_WT_BAS_AMT,
	NULL AS OUTB_INCL_TAX_USD_WT_BAS_AMT,
	NULL AS OUTB_TRNSP_TAX_USD_WT_BAS_AMT,
	NULL AS TRNSP_BASE_RT_USD_WT_BAS_AMT,
	NULL AS TRNSP_OTH_COST_USD_WT_BAS_AMT,
	NULL AS TRAVL_DSTC_COST_USD_WT_BAS_AMT,
	NULL AS WAIT_TIME_COST_USD_WT_BAS_AMT,
	NULL AS WT_AMT_COST_WT_BAS_AMT,
	NULL AS OUTB_EXTRA_COST_USD_WT_BAS_AMT,
	NULL AS EST_WT_BAS_FUEL_SURC_AMT,
	NULL AS TOT_ACCSORIAL_PD_WT_BAS_AMT,
	NULL AS TOT_FRGHT_CHRG_WT_BAS_AMT,
	NULL AS TOT_PLAN_WT_BAS_COST_AMT,
	CST_SLS_TRN.ORIG_RQST_DELV_DT AS ORIG_RQST_DELV_DT,
	CST_SLS_TRN.RQST_DELV_DT AS RQST_DELV_DT,
	CST_TPT_TRN.PRC_PCDR1_AMT AS PRC_PCDR1_AMT,
	CST_TPT_TRN.BRND_DESC AS BRND_DESC,
	CST_TPT_TRN.GBU_DESC AS GBU_DESC,
	CST_TPT_TRN.FRAN_DESC AS FRAN_DESC,
	CST_TPT_TRN.MATL_RGM_CLSN_CD AS MATL_RGM_CLSN_CD,
	CST_TPT_TRN.FISC_CUR_MO_IND AS FISC_CUR_MO_IND,
	CST_TPT_TRN.REL_TO_TDY_FISC_MO_CNT AS REL_TO_TDY_FISC_MO_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_QTR_CNT AS REL_TO_TDY_FISC_QTR_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_YR_CNT AS REL_TO_TDY_FISC_YR_CNT,
	CST_TPT_TRN.CAL_DT AS CAL_DT,
	CST_TPT_TRN.FISC_QTR_STRT_DT AS FISC_QTR_STRT_DT,
	CST_TPT_TRN.FISC_QE_DT AS FISC_QE_DT,
	CST_TPT_TRN.FISC_WK_STRT_DT AS FISC_WK_STRT_DT,
	CST_TPT_TRN.FISC_WK_END_DT AS FISC_WK_END_DT,
	'' AS NON_CMPNT_IND,
	NULL AS CUST_SEG_CD,
	'SRC_SYS_CD|^DELV_NUM|^DELV_LINE_NBR|^SLS_ORDR_NUM|^SLS_ORDR_LINE_NBR' AS LOGL_KEY_CMBN_COL_NM,
	CONCAT(CST_DELV_TRN.SRC_SYS_CD, '|^', CST_DELV_TRN.DELV_NUM, '|^', CST_DELV_TRN.DELV_LINE_NBR, '|^', CST_SLS_TRN.SLS_ORDR_NUM, '|^', CST_SLS_TRN.SLS_ORDR_LINE_NBR) AS LOGL_KEY_CMBN_COL_VAL,
	CAST(CURRENT_TIMESTAMP() AS BIGINT) AS DAI_BTCH_ID,
	CURRENT_TIMESTAMP() AS DAI_UPDT_DTTM,
	CURRENT_TIMESTAMP() AS DAI_CRT_DTTM,
	CST_DELV_TRN.SRC_SYS_CD AS SRC_SYS_CD,
	CST_DELV_TRN.CRT_YR_NBR AS CRT_YR_NBR,
	CST_DELV_TRN.CRT_MO_NBR AS CRT_MO_NBR
FROM DELV.CST_DELV_TRN
INNER JOIN DELV.CST_SLS_TRN ON CST_DELV_TRN.DELV_NUM = CST_SLS_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_SLS_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_SLS_TRN.SRC_SYS_CD
INNER JOIN DELIV_FILES.COUNTRY_INC ON CST_DELV_TRN.SRC_SYS_CD = COUNTRY_INC.SRC_SYS_CD AND CST_SLS_TRN.PLNT_CTRY_CD = COUNTRY_INC.PLNT_CTRY_CD
LEFT OUTER JOIN DELV.CST_MATL_UOM ON CST_DELV_TRN.DELV_NUM = CST_MATL_UOM.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_MATL_UOM.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_MATL_UOM.SRC_SYS_CD
LEFT OUTER JOIN DELV.CST_TPT_TRN ON CST_DELV_TRN.DELV_NUM = CST_TPT_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_TPT_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_TPT_TRN.SRC_SYS_CD
LEFT OUTER JOIN DELV.CST_WH_TRN ON CST_DELV_TRN.DELV_NUM = CST_WH_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_WH_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_WH_TRN.SRC_SYS_CD
LEFT OUTER JOIN SC_CORE.MATL_ALT_UOM ON MATL_ALT_UOM.MATL_NUM = CST_MATL_UOM.MATL_NUM AND cst_sls_trn.ORDR_BASE_UOM_CD = matl_alt_uom.matl_alt_uom_cd AND CST_DELV_TRN.SRC_SYS_CD = MATL_ALT_UOM.SRC_SYS_CD
LEFT OUTER JOIN SC_WRK.CURRENCY_RATE AS CURRENCY_RATE_1 ON CST_SLS_TRN.SLS_ORDR_CRNCY_CD = CURRENCY_RATE_1.SOURCE_CURRENCY_CODE AND CAST(CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS DATE) BETWEEN CAST(CURRENCY_RATE_1.BUSINESS_EFFECTIVE_START_DATE AS DATE) AND CAST(CURRENCY_RATE_1.BUSINESS_EFFECTIVE_END_DATE AS DATE)
LEFT OUTER JOIN SC_WRK.CURRENCY_RATE AS CURRENCY_RATE_2 ON CST_SLS_TRN.LCL_CRNCY_CD = CURRENCY_RATE_2.SOURCE_CURRENCY_CODE AND CAST(CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS DATE) BETWEEN CAST(CURRENCY_RATE_2.BUSINESS_EFFECTIVE_START_DATE AS DATE) AND CAST(CURRENCY_RATE_2.BUSINESS_EFFECTIVE_END_DATE AS DATE)
WHERE CST_SLS_TRN.SRC_SYS_CD = 'CLA' AND CST_DELV_TRN.ACTL_SKU_DELV_QTY > 0 AND UPPER(COUNTRY_INC.COUNTRY_INC) ='YES'

UNION ALL

--Below query is generated from : Supply_Chain/Deliver/CostToDeliver_Final_Transaction_EMEA.csv
SELECT DISTINCT
	CST_DELV_TRN.DELV_NUM AS DELV_NUM,
	CST_DELV_TRN.DELV_LINE_NBR AS DELV_LINE_NBR,
	CST_DELV_TRN.SLS_ORDR_NUM AS SLS_ORDR_NUM,
	CST_DELV_TRN.SLS_ORDR_LINE_NBR AS SLS_ORDR_LINE_NBR,
	CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS SLS_ORDR_CRT_DTTM,
	CST_SLS_TRN.SLS_ORDR_TYPE_CD AS SLS_ORDR_TYPE_CD,
	CST_SLS_TRN.SLS_ORDR_TYPE_DESC AS SLS_ORDR_TYPE_DESC,
	CST_SLS_TRN.PLNT_CD AS PLNT_CD,
	CST_SLS_TRN.PLNT_NM AS PLNT_NM,
	CST_SLS_TRN.PLNT_CITY_NM AS PLNT_CITY_NM,
	CST_SLS_TRN.PLNT_CTRY_CD AS PLNT_CTRY_CD,
	CST_SLS_TRN.PLNT_PSTL_CD_NUM AS PLNT_PSTL_CD_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NUM AS SOLD_TO_CUST_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NM AS SOLD_TO_CUST_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CITY_NM AS SOLD_TO_CUST_CITY_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CTRY_CD AS SOLD_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SOLD_TO_ST_PRVNC_CD AS SOLD_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SOLD_TO_CUST_PSTL_NUM AS SOLD_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NUM AS SHIP_TO_CUST_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NM AS SHIP_TO_CUST_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CITY_NM AS SHIP_TO_CUST_CITY_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CTRY_CD AS SHIP_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SHIP_TO_ST_PRVNC_CD AS SHIP_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SHIP_TO_CUST_PSTL_NUM AS SHIP_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.CUST_PO_TYPE_CD AS CUST_PO_TYPE_CD,
	CST_SLS_TRN.CUST_PO_TYPE_DESC AS CUST_PO_TYPE_DESC,
	CST_SLS_TRN.SLORG_NUM AS SLORG_NUM,
	CST_SLS_TRN.DSTR_CHNL_CD AS DSTR_CHNL_CD,
	CST_SLS_TRN.DSTR_CHNL_DESC AS DSTR_CHNL_DESC,
	CST_SLS_TRN.SLS_ORDR_QTY AS SLS_ORDR_QTY,
	CST_SLS_TRN.ORDR_BASE_UOM_CD AS ORDR_BASE_UOM_CD,
	CST_SLS_TRN.SLS_UOM_ORDR_QTY AS SLS_UOM_ORDR_QTY,
	CST_SLS_TRN.SLS_UOM_CD AS SLS_UOM_CD,
	CST_SLS_TRN.SLS_ITEM_COST_AMT AS SLS_ITEM_COST_AMT,
	NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0)* CST_DELV_TRN.ACTL_SKU_DELV_QTY AS NET_VAL_AMT_SLS,
	CST_SLS_TRN.SLS_ITEM_SUB_1_AMT AS SLS_ITEM_SUB_1_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_2_AMT AS SLS_ITEM_SUB_2_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_3_AMT AS SLS_ITEM_SUB_3_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_4_AMT AS SLS_ITEM_SUB_4_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_5_AMT AS SLS_ITEM_SUB_5_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_6_AMT AS SLS_ITEM_SUB_6_AMT,
	CST_SLS_TRN.CUST_CLUS_CD AS CUST_CLUS_CD,
	CST_SLS_TRN.CUST_SUB_CLUS_CD AS CUST_SUB_CLUS_CD,
	CST_SLS_TRN.CUST_REGN_MKT_CD AS CUST_REGN_MKT_CD,
	CST_SLS_TRN.CUST_TTL_ENT_CD AS CUST_TTL_ENT_CD,
	CST_SLS_TRN.CUST_RTL_BNR_CD AS CUST_RTL_BNR_CD,
	CST_SLS_TRN.CUST_INDSTR_1_CD AS CUST_INDSTR_1_CD,
	CST_SLS_TRN.CUST_INDSTR_2_CD AS CUST_INDSTR_2_CD,
	CST_SLS_TRN.CUST_INDSTR_3_CD AS CUST_INDSTR_3_CD,
	CST_SLS_TRN.CUST_INDSTR_4_CD AS CUST_INDSTR_4_CD,
	CST_SLS_TRN.CUST_INDSTR_5_CD AS CUST_INDSTR_5_CD,
	CST_SLS_TRN.FISC_MO_SHRT_NM AS FISC_MO_SHRT_NM,
	CST_SLS_TRN.FISC_YR_NBR AS FISC_YR_NBR,
	CST_SLS_TRN.CAL_DAY_SHRT_NM AS CAL_DAY_SHRT_NM,
	CST_SLS_TRN.FISC_WK_NBR AS FISC_WK_NBR,
	CST_SLS_TRN.FISC_QTR_NM AS FISC_QTR_NM,
	CST_SLS_TRN.FISC_MO_STRT_DT AS FISC_MO_STRT_DT,
	CST_SLS_TRN.FISC_MO_END_DT AS FISC_MO_END_DT,
	CST_DELV_TRN.DELV_TYPE_CD AS DELV_TYPE_CD,
	CST_DELV_TRN.DELV_CRT_DTTM AS DELV_CRT_DTTM,
	CST_DELV_TRN.MATL_NUM AS MATL_NUM,
	CST_DELV_TRN.RTE_NUM AS RTE_NUM,
	CST_DELV_TRN.PICK_DTTM AS PICK_DTTM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY AS ACTL_SKU_DELV_QTY,
	CST_DELV_TRN.DELV_BASE_UOM_CD AS DELV_BASE_UOM_CD,
	CST_DELV_TRN.ACTL_SLS_UNIT_DELV_QTY AS ACTL_SLS_UNIT_DELV_QTY,
	CST_DELV_TRN.MATL_SHRT_DESC AS MATL_SHRT_DESC,
	CST_DELV_TRN.GLBL_BRND_DESC AS GLBL_BRND_DESC,
	CST_DELV_TRN.RGN_BRND_DESC AS RGN_BRND_DESC,
	CST_DELV_TRN.RGN_MEGA_BRND_DESC AS RGN_MEGA_BRND_DESC,
	CST_DELV_TRN.PROD_CAT_DESC AS PROD_CAT_DESC,
	CST_DELV_TRN.TRSPN_GRP_CD AS TRSPN_GRP_CD,
	CST_DELV_TRN.RGN_BASE_PROD_DESC AS RGN_BASE_PROD_DESC,
	CST_DELV_TRN.RGN_VRNT_DESC AS RGN_VRNT_DESC,
	CST_DELV_TRN.RGN_PUT_UP_DESC AS RGN_PUT_UP_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_1_DESC AS MATL_GLOBL_HIER_1_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_2_DESC AS MATL_GLOBL_HIER_2_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_3_DESC AS MATL_GLOBL_HIER_3_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_4_DESC AS MATL_GLOBL_HIER_4_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_5_DESC AS MATL_GLOBL_HIER_5_DESC,
	CST_MATL_UOM.GRS_WT_MEAS_PC AS GRS_WT_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS FCTR_NUMRTR_MEAS_CS,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_CS AS FCTR_DNMNTR_MEAS_CS,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PC AS FCTR_NUMRTR_MEAS_PC,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PC AS FCTR_DNMNTR_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS FCTR_NUMRTR_MEAS_PL,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PL AS FCTR_DNMNTR_MEAS_PL,
	CST_MATL_UOM.VOL_MEAS_CS AS VOL_MEAS_CS,
	CST_MATL_UOM.VOL_MEAS_PC AS VOL_MEAS_PC,
	CST_MATL_UOM.VOL_UOM_MEAS AS VOL_UOM_MEAS,
	CST_MATL_UOM.VOL_MEAS_PL AS VOL_MEAS_PL,
	CST_MATL_UOM.CS_PER_PLLT_UOM AS CS_PER_PLLT_UOM,
	CST_TPT_TRN.TRSPN_OTH_COST_AMT AS TRSPN_OTH_COST_AMT,
	CST_TPT_TRN.FUEL_SURC_COST_AMT AS FUEL_SURC_COST_AMT,
	CST_TPT_TRN.MLT_DRP_COST_AMT AS MLT_DRP_COST_AMT,
	CST_TPT_TRN.OVNT_COST_AMT AS OVNT_COST_AMT,
	CST_TPT_TRN.TRAVL_DSTC_COST_AMT AS TRAVL_DSTC_COST_AMT,
	CST_TPT_TRN.UNLD_COST_AMT AS UNLD_COST_AMT,
	CST_TPT_TRN.WAIT_TIME_COST_AMT AS WAIT_TIME_COST_AMT,
	CST_TPT_TRN.WT_AMT_COST AS WT_AMT_COST,
	CST_TPT_TRN.CROS_DK_COST_AMT AS CROS_DK_COST_AMT,
	CST_TPT_TRN.TRSPN_BASE_RT AS TRSPN_BASE_RT,
	CST_TPT_TRN.PER_KM_TRSPN_COST_AMT AS PER_KM_TRSPN_COST_AMT,
	CST_TPT_TRN.UTLZ_LTL_LCL_PCT AS UTLZ_LTL_LCL_PCT,
	CST_TPT_TRN.DELV_DSTC_IN_KM AS DELV_DSTC_IN_KM,
	CST_TPT_TRN.BILL_OF_LDNG AS BILL_OF_LDNG,
	CST_TPT_TRN.SHIP_MODE AS SHIP_MODE,
	CST_TPT_TRN.TRK_MAX_CAPY_CBM AS TRK_MAX_CAPY_CBM,
	CST_TPT_TRN.TRK_MAX_CAPY_KG AS TRK_MAX_CAPY_KG,
	CST_TPT_TRN.GRS_VOL_CBM AS GRS_VOL_CBM,
	CST_TPT_TRN.NET_VOL_CBM AS NET_VOL_CBM,
	CST_TPT_TRN.TRSPN_TYPE_CD AS TRSPN_TYPE_CD,
	CST_TPT_TRN.SHIP_TYPE_CD AS SHIP_TYPE_CD,
	CST_TPT_TRN.NET_WT_QTY AS NET_WT_QTY,
	CST_TPT_TRN.GRS_WT_QTY AS GRS_WT_QTY,
	CST_TPT_TRN.CHRG_MECH_CD AS CHRG_MECH_CD,
	CST_TPT_TRN.RT_CARD_ID AS RT_CARD_ID,
	CST_TPT_TRN.ORIG_CD AS ORIG_CD,
	CST_TPT_TRN.DEST_CD AS DEST_CD,
	CST_TPT_TRN.SNDR_ST_CD AS SNDR_ST_CD,
	CST_TPT_TRN.RCVR_ST_CD AS RCVR_ST_CD,
	CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT AS OUTB_TRSPN_INCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT AS OUTB_TRSPN_EXCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_TAX_AMT AS OUTB_TRSPN_TAX_AMT,
	CST_TPT_TRN.DIST_TRVL_RATE_AMT AS DIST_TRVL_RATE_AMT,
	CST_TPT_TRN.WAIT_TIME_RATE_AMT AS WAIT_TIME_RATE_AMT,
	CST_TPT_TRN.RATE_PER_KG_AMT AS RATE_PER_KG_AMT,
	CST_TPT_TRN.FUEL_SURC_PCT AS FUEL_SURC_PCT,
	CST_TPT_TRN.DELV_VEND_NM AS DELV_VEND_NM,
	CST_TPT_TRN.LANE_ID AS LANE_ID,
	CST_TPT_TRN.CARR_NM AS CARR_NM,
	CST_TPT_TRN.TRK_TYPE_DESC AS TRK_TYPE_DESC,
	CST_TPT_TRN.ACTL_DC_DSPCH_FRM_DTTM AS ACTL_DC_DSPCH_FRM_DTTM,
	CST_TPT_TRN.SHIP_REF_NUM AS SHIP_REF_NUM,
	CST_TPT_TRN.SHIP_PRIR_DESC AS SHIP_PRIR_DESC,
	CST_TPT_TRN.OUTB_EXTRA_COST_AMT AS OUTB_EXTRA_COST_AMT,
	CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT AS OUTB_TPT_VOL_COST_AMT,
	CST_TPT_TRN.DELV_DTTM AS DELV_DTTM,
	CST_WH_TRN.LBR_COST_AMT_PL AS LBR_COST_AMT_PL,
	CST_WH_TRN.LBR_COST_AMT_CS AS LBR_COST_AMT_CS,
	CST_WH_TRN.LBR_COST_AMT_PC AS LBR_COST_AMT_PC,
	CST_WH_TRN.TTL_CUST_SRVC_COST_AMT AS TTL_CUST_SRVC_COST_AMT,
	CST_WH_TRN.FX_COST_AMT AS FX_COST_AMT,
	CST_WH_TRN.STRG_COST_AMT AS STRG_COST_AMT,
	CST_WH_TRN.OTH_COST_AMT AS OTH_COST_AMT,
	CST_WH_TRN.CNSUM_COST_AMT AS CNSUM_COST_AMT,
	CST_WH_TRN.OUTB_HNDG_COST_AMT AS OUTB_HNDG_COST_AMT,
	CST_WH_TRN.TTL_WH_COST_AMT AS TTL_WH_COST_AMT,
	CASE
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PC', 'EA') THEN CST_SLS_TRN.SLS_ORDR_QTY
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL)
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS)
	ELSE 0
	END AS SLS_ORDR_QTY_PC,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS SLS_ORDR_QTY_CASE,
	CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC AS SLS_ORDR_QTY_PC_CBM,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS SLS_ORDR_QTY_PLLT,
	CASE
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PC', 'EA') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS
	ELSE 0
	END AS ACTL_DELV_QTY_PC,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS ACTL_DELV_QTY_CASE,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.VOL_MEAS_PC AS ACTL_DELV_QTY_PC_CBM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS ACTL_DELV_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT AS PICK_PACK_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_CASE AS PICK_PACK_QTY_CASE,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PC AS PICK_PACK_QTY_PC,
	(NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT, 0)) AS TTL_DELV_COST_AMT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC)) AS TTL_DELV_COST_AMT_CBM,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL) AS TTL_DELV_COST_AMT_PLLT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS) AS TTL_DELV_COST_AMT_CASE,
	CST_SLS_TRN.LCL_CRNCY_CD AS LCL_CRNCY_CD,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_COST_AMT) AS SLS_ITEM_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_1_AMT) AS SLS_ITEM_SUB_1_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_2_AMT) AS SLS_ITEM_SUB_2_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_3_AMT) AS SLS_ITEM_SUB_3_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_4_AMT) AS SLS_ITEM_SUB_4_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_5_AMT) AS SLS_ITEM_SUB_5_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_SLS_TRN.SLS_ITEM_SUB_6_AMT) AS SLS_ITEM_SUB_6_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0)* CST_DELV_TRN.ACTL_SKU_DELV_QTY)) AS NET_VAL_USD_AMT_SLS,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.CNSUM_COST_AMT) AS CNSUM_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.FX_COST_AMT) AS FX_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.OTH_COST_AMT) AS OTH_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.OUTB_HNDG_COST_AMT) AS OUTB_HNDG_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.LBR_COST_AMT_PL) AS LBR_COST_USD_AMT_PL,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.LBR_COST_AMT_CS) AS LBR_COST_USD_AMT_CS,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.STRG_COST_AMT) AS STRG_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.TTL_CUST_SRVC_COST_AMT) AS TTL_CUST_SRVC_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.LBR_COST_AMT_PC) AS LBR_COST_USD_AMT_PC,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_WH_TRN.TTL_WH_COST_AMT) AS TTL_WH_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.CROS_DK_COST_AMT) AS CROS_DK_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.FUEL_SURC_COST_AMT) AS FUEL_SURC_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.MLT_DRP_COST_AMT) AS MLT_DRP_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_EXTRA_COST_AMT) AS OUTB_EXTRA_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT) AS OUTB_TPT_VOL_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OVNT_COST_AMT) AS OVNT_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT) AS OUTB_TRSN_EXCL_TAX_CST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT) AS OUTB_TRSN_INCL_TAX_CST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.OUTB_TRSPN_TAX_AMT) AS OUTB_TRSN_TAX_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.TRSPN_BASE_RT) AS TRSPN_BASE_RT_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.PER_KM_TRSPN_COST_AMT) AS PER_KM_TRSPN_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.TRSPN_OTH_COST_AMT) AS TRSPN_OTH_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.TRAVL_DSTC_COST_AMT) AS TRAVL_DSTC_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.UNLD_COST_AMT) AS UNLD_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.WAIT_TIME_COST_AMT) AS WAIT_TIME_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.WAIT_TIME_RATE_AMT) AS WAIT_TIME_RATE_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.WT_AMT_COST) AS WT_AMT_COST_USD,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.DIST_TRVL_RATE_AMT) AS DIST_TRVL_RATE_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * CST_TPT_TRN.RATE_PER_KG_AMT) AS RATE_PER_KG_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT, 0))) AS TTL_DELV_COST_USD_AMT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * (NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC))) AS TTL_DELV_COST_USD_AMT_CBM,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * ((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL)) AS TTL_DELV_COST_USD_AMT_PLLT,
	(CURRENCY_RATE.SOURCE_TO_TARGET_CURRENCY_RATE * ((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS)) AS TTL_DELV_COST_USD_AMT_CASE,
	CST_SLS_TRN.SLS_ORDR_GEN_NM AS SLS_ORDR_GEN_NM,
	CST_SLS_TRN.REGION_INC AS REGION_INC,
	CST_SLS_TRN.LINE_ITEM_CAT_CD AS LINE_ITEM_CAT_CD,
	CST_DELV_TRN.ACTL_GI_DT AS ACTL_GI_DT,
	'' AS OUT_OF_SRVC_IND,
	CST_SLS_TRN.KEY_CUST_NM AS KEY_CUST_NM,
	CST_SLS_TRN.KEY_CUST_NUM AS KEY_CUST_NUM,
	CST_TPT_TRN.LD_NUM AS LD_NUM,
	CST_TPT_TRN.PLAN_GI_DT AS PLAN_GI_DT,
	CST_TPT_TRN.INVC_CRT_DT AS INVC_CRT_DT,
	CST_TPT_TRN.SLS_INVC_NUM AS SLS_INVC_NUM,
	CST_TPT_TRN.PO_NUM AS PO_NUM,
	CST_TPT_TRN.CARR_CD AS CARR_CD,
	CST_TPT_TRN.CMMDTY_CD AS CMMDTY_CD,
	CST_TPT_TRN.CARR_PRO_NUM AS CARR_PRO_NUM,
	CST_TPT_TRN.TMS_MATCH_IND AS TMS_MATCH_IND,
    CST_TPT_TRN.FRGHT_MATCH_IND AS FRGHT_MATCH_IND,
	CST_TPT_TRN.EST_FUEL_SURC_AMT AS EST_FUEL_SURC_AMT,
	CST_TPT_TRN.TOT_ACCSORIAL_PD_AMT AS TOT_ACCSORIAL_PD_AMT,
	CST_TPT_TRN.TOT_FRGHT_CHRG_AMT AS TOT_FRGHT_CHRG_AMT,
	CST_TPT_TRN.TOT_PLAN_COST_AMT AS TOT_PLAN_COST_AMT,
	CST_TPT_TRN.EST_ACTL_DIFF_COST_AMT AS EST_ACTL_DIFF_COST_AMT,
	CST_TPT_TRN.GRS_WT_MEAS AS GRS_WT_MEAS,
	CST_TPT_TRN.INVC_LINE_ITEM_VOL_MEAS AS INVC_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.GRS_WT_ITM_QTY AS GRS_WT_ITM_QTY,
	CST_TPT_TRN.SLS_LINE_ITEM_VOL_MEAS AS SLS_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.PLNT_ADDR_NUM AS PLNT_ADDR_NUM,
	CST_TPT_TRN.SHIP_COND_CD AS SHIP_COND_CD,
	NULL AS NTWK_SHIP_TO_NM,
	CST_TPT_TRN.INVC_CNT AS INVC_CNT,
	CST_TPT_TRN.SLS_CNFRM_CASE_QTY AS SLS_CNFRM_CASE_QTY,
	CST_TPT_TRN.CUST_UNIT_SLS_CNFRM_QTY AS CUST_UNIT_SLS_CNFRM_QTY,
	CST_TPT_TRN.SLS_CNFRM_EA_QTY AS SLS_CNFRM_EA_QTY,
	CST_TPT_TRN.INVC_EA_QTY AS INVC_EA_QTY,
	CST_TPT_TRN.INVC_CASE_QTY AS INVC_CASE_QTY,
	CST_TPT_TRN.SLS_ORDR_CASE_QTY AS SLS_ORDR_CASE_QTY,
	CST_TPT_TRN.SNGL_SRC_MATL_IND AS SNGL_SRC_MATL_IND,
	CST_TPT_TRN.PMT_SYS_DTTM AS PMT_SYS_DTTM,
	NULL AS CROSSDK_WT_BAS_COST_AMT,
	NULL AS FUEL_SURC_WT_BAS_COST_AMT,
	NULL AS MULTIDROP_WT_BAS_COST_AMT,
	NULL AS OUTB_WT_BAS_COST_EXTRA_AMT,
	NULL AS OVNT_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_COST_TAX_AMT,
	NULL AS TRNSP_WT_BAS_COST_INC_TAX_AMT,
	NULL AS TRNSP_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_BASE_RT_AMT,
	NULL AS TRNSP_WT_BAS_OTH_COST_AMT,
	NULL AS UNLDING_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_COST_EXCL_TAX_AMT,
	NULL AS WAIT_TIME_BAS_COST_AMT,
	NULL AS WT_AMT_COST_AMT,
	NULL AS TRAVL_DSTC_BAS_COST_AMT,
	NULL AS UNLD_COST_USD_WT_BAS_AMT,
	NULL AS CROSSDK_COST_USD_WT_BAS_AMT,
	NULL AS FUEL_SURC_COST_USD_WT_BAS_AMT,
	NULL AS MULTIDROP_COST_USD_WT_BAS_AMT,
	NULL AS OVNT_COST_USD_WT_BASE_AMT,
	NULL AS OUTB_EXCL_TAX_USD_WT_BAS_AMT,
	NULL AS OUTB_INCL_TAX_USD_WT_BAS_AMT,
	NULL AS OUTB_TRNSP_TAX_USD_WT_BAS_AMT,
	NULL AS TRNSP_BASE_RT_USD_WT_BAS_AMT,
	NULL AS TRNSP_OTH_COST_USD_WT_BAS_AMT,
	NULL AS TRAVL_DSTC_COST_USD_WT_BAS_AMT,
	NULL AS WAIT_TIME_COST_USD_WT_BAS_AMT,
	NULL AS WT_AMT_COST_WT_BAS_AMT,
	NULL AS OUTB_EXTRA_COST_USD_WT_BAS_AMT,
	NULL AS EST_WT_BAS_FUEL_SURC_AMT,
	NULL AS TOT_ACCSORIAL_PD_WT_BAS_AMT,
	NULL AS TOT_FRGHT_CHRG_WT_BAS_AMT,
	NULL AS TOT_PLAN_WT_BAS_COST_AMT,
	CST_SLS_TRN.ORIG_RQST_DELV_DT AS ORIG_RQST_DELV_DT,
	CST_SLS_TRN.RQST_DELV_DT AS RQST_DELV_DT,
	CST_TPT_TRN.PRC_PCDR1_AMT AS PRC_PCDR1_AMT,
	CST_TPT_TRN.BRND_DESC AS BRND_DESC,
	CST_TPT_TRN.GBU_DESC AS GBU_DESC,
	CST_TPT_TRN.FRAN_DESC AS FRAN_DESC,
	CST_TPT_TRN.MATL_RGM_CLSN_CD AS MATL_RGM_CLSN_CD,
	CST_TPT_TRN.FISC_CUR_MO_IND AS FISC_CUR_MO_IND,
	CST_TPT_TRN.REL_TO_TDY_FISC_MO_CNT AS REL_TO_TDY_FISC_MO_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_QTR_CNT AS REL_TO_TDY_FISC_QTR_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_YR_CNT AS REL_TO_TDY_FISC_YR_CNT,
	CST_TPT_TRN.CAL_DT AS CAL_DT,
	CST_TPT_TRN.FISC_QTR_STRT_DT AS FISC_QTR_STRT_DT,
	CST_TPT_TRN.FISC_QE_DT AS FISC_QE_DT,
	CST_TPT_TRN.FISC_WK_STRT_DT AS FISC_WK_STRT_DT,
	CST_TPT_TRN.FISC_WK_END_DT AS FISC_WK_END_DT,
	'' AS NON_CMPNT_IND,
	NULL AS CUST_SEG_CD,
	'SRC_SYS_CD|^DELV_NUM|^DELV_LINE_NBR|^SLS_ORDR_NUM|^SLS_ORDR_LINE_NBR' AS LOGL_KEY_CMBN_COL_NM,
	CONCAT(CST_DELV_TRN.SRC_SYS_CD, '|^', CST_DELV_TRN.DELV_NUM, '|^', CST_DELV_TRN.DELV_LINE_NBR, '|^', CST_SLS_TRN.SLS_ORDR_NUM, '|^', CST_SLS_TRN.SLS_ORDR_LINE_NBR) AS LOGL_KEY_CMBN_COL_VAL,
	CAST(CURRENT_TIMESTAMP() AS BIGINT) AS DAI_BTCH_ID,
	CURRENT_TIMESTAMP() AS DAI_UPDT_DTTM,
	CURRENT_TIMESTAMP() AS DAI_CRT_DTTM,
	CST_DELV_TRN.SRC_SYS_CD AS SRC_SYS_CD,
	CST_DELV_TRN.CRT_YR_NBR AS CRT_YR_NBR,
	CST_DELV_TRN.CRT_MO_NBR AS CRT_MO_NBR
FROM DELV.CST_DELV_TRN
INNER JOIN DELV.CST_SLS_TRN ON CST_DELV_TRN.DELV_NUM = CST_SLS_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_SLS_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_SLS_TRN.SRC_SYS_CD
INNER JOIN DELIV_FILES.COUNTRY_INC ON CST_DELV_TRN.SRC_SYS_CD = COUNTRY_INC.SRC_SYS_CD AND CST_SLS_TRN.PLNT_CTRY_CD = COUNTRY_INC.PLNT_CTRY_CD
LEFT OUTER JOIN DELV.CST_MATL_UOM ON CST_DELV_TRN.DELV_NUM = CST_MATL_UOM.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_MATL_UOM.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_MATL_UOM.SRC_SYS_CD
LEFT OUTER JOIN DELV.CST_TPT_TRN ON CST_DELV_TRN.DELV_NUM = CST_TPT_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_TPT_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_TPT_TRN.SRC_SYS_CD
LEFT OUTER JOIN DELV.CST_WH_TRN ON CST_DELV_TRN.DELV_NUM = CST_WH_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_WH_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_WH_TRN.SRC_SYS_CD
LEFT OUTER JOIN SC_CORE.MATL_ALT_UOM ON MATL_ALT_UOM.MATL_NUM = CST_MATL_UOM.MATL_NUM AND cst_sls_trn.ORDR_BASE_UOM_CD = matl_alt_uom.matl_alt_uom_cd AND CST_DELV_TRN.SRC_SYS_CD = MATL_ALT_UOM.SRC_SYS_CD
LEFT OUTER JOIN SC_WRK.CURRENCY_RATE ON CST_SLS_TRN.LCL_CRNCY_CD = CURRENCY_RATE.SOURCE_CURRENCY_CODE AND CAST(CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS DATE) BETWEEN CAST(CURRENCY_RATE.BUSINESS_EFFECTIVE_START_DATE AS DATE) AND CAST(CURRENCY_RATE.BUSINESS_EFFECTIVE_END_DATE AS DATE)
WHERE CST_SLS_TRN.SRC_SYS_CD = 'STF' AND CST_DELV_TRN.ACTL_SKU_DELV_QTY > 0 AND UPPER(COUNTRY_INC.COUNTRY_INC) ='YES'

UNION ALL
--Below query is generated from : Supply_Chain/Deliver/CostToDeliver_Final_Transaction_US1.csv
SELECT DISTINCT
	CST_DELV_TRN.DELV_NUM AS DELV_NUM,
	CST_DELV_TRN.DELV_LINE_NBR AS DELV_LINE_NBR,
	CST_DELV_TRN.SLS_ORDR_NUM AS SLS_ORDR_NUM,
	CST_DELV_TRN.SLS_ORDR_LINE_NBR AS SLS_ORDR_LINE_NBR,
	CST_SLS_TRN.SLS_ORDR_CRT_DTTM AS SLS_ORDR_CRT_DTTM,
	CST_SLS_TRN.SLS_ORDR_TYPE_CD AS SLS_ORDR_TYPE_CD,
	CST_SLS_TRN.SLS_ORDR_TYPE_DESC AS SLS_ORDR_TYPE_DESC,
	CST_SLS_TRN.PLNT_CD AS PLNT_CD,
	CST_SLS_TRN.PLNT_NM AS PLNT_NM,
	CST_SLS_TRN.PLNT_CITY_NM AS PLNT_CITY_NM,
	CST_SLS_TRN.PLNT_CTRY_CD AS PLNT_CTRY_CD,
	CST_SLS_TRN.PLNT_PSTL_CD_NUM AS PLNT_PSTL_CD_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NUM AS SOLD_TO_CUST_NUM,
	CST_SLS_TRN.SOLD_TO_CUST_NM AS SOLD_TO_CUST_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CITY_NM AS SOLD_TO_CUST_CITY_NM,
	CST_SLS_TRN.SOLD_TO_CUST_CTRY_CD AS SOLD_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SOLD_TO_ST_PRVNC_CD AS SOLD_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SOLD_TO_CUST_PSTL_NUM AS SOLD_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NUM AS SHIP_TO_CUST_NUM,
	CST_SLS_TRN.SHIP_TO_CUST_NM AS SHIP_TO_CUST_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CITY_NM AS SHIP_TO_CUST_CITY_NM,
	CST_SLS_TRN.SHIP_TO_CUST_CTRY_CD AS SHIP_TO_CUST_CTRY_CD,
	CST_SLS_TRN.SHIP_TO_ST_PRVNC_CD AS SHIP_TO_ST_PRVNC_CD,
	CST_SLS_TRN.SHIP_TO_CUST_PSTL_NUM AS SHIP_TO_CUST_PSTL_NUM,
	CST_SLS_TRN.CUST_PO_TYPE_CD AS CUST_PO_TYPE_CD,
	CST_SLS_TRN.CUST_PO_TYPE_DESC AS CUST_PO_TYPE_DESC,
	CST_SLS_TRN.SLORG_NUM AS SLORG_NUM,
	CST_SLS_TRN.DSTR_CHNL_CD AS DSTR_CHNL_CD,
	CST_SLS_TRN.DSTR_CHNL_DESC AS DSTR_CHNL_DESC,
	CST_SLS_TRN.SLS_ORDR_QTY AS SLS_ORDR_QTY,
	CST_SLS_TRN.ORDR_BASE_UOM_CD AS ORDR_BASE_UOM_CD,
	CST_SLS_TRN.SLS_UOM_ORDR_QTY AS SLS_UOM_ORDR_QTY,
	CST_SLS_TRN.SLS_UOM_CD AS SLS_UOM_CD,
	CST_SLS_TRN.SLS_ITEM_COST_AMT AS SLS_ITEM_COST_AMT,
	NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0) AS NET_VAL_AMT_SLS,
	CST_SLS_TRN.SLS_ITEM_SUB_1_AMT AS SLS_ITEM_SUB_1_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_2_AMT AS SLS_ITEM_SUB_2_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_3_AMT AS SLS_ITEM_SUB_3_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_4_AMT AS SLS_ITEM_SUB_4_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_5_AMT AS SLS_ITEM_SUB_5_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_6_AMT AS SLS_ITEM_SUB_6_AMT,
	CST_SLS_TRN.CUST_CLUS_CD AS CUST_CLUS_CD,
	CST_SLS_TRN.CUST_SUB_CLUS_CD AS CUST_SUB_CLUS_CD,
	CST_SLS_TRN.CUST_REGN_MKT_CD AS CUST_REGN_MKT_CD,
	CST_SLS_TRN.CUST_TTL_ENT_CD AS CUST_TTL_ENT_CD,
	CST_SLS_TRN.CUST_RTL_BNR_CD AS CUST_RTL_BNR_CD,
	CST_SLS_TRN.CUST_INDSTR_1_CD AS CUST_INDSTR_1_CD,
	CST_SLS_TRN.CUST_INDSTR_2_CD AS CUST_INDSTR_2_CD,
	CST_SLS_TRN.CUST_INDSTR_3_CD AS CUST_INDSTR_3_CD,
	CST_SLS_TRN.CUST_INDSTR_4_CD AS CUST_INDSTR_4_CD,
	CST_SLS_TRN.CUST_INDSTR_5_CD AS CUST_INDSTR_5_CD,
	CST_TPT_TRN.FISC_MO_SHRT_NM AS FISC_MO_SHRT_NM,
	CST_TPT_TRN.FISC_YR_NBR AS FISC_YR_NBR,
	CST_TPT_TRN.CAL_DAY_SHRT_NM AS CAL_DAY_SHRT_NM,
	CST_TPT_TRN.FISC_WK_NBR AS FISC_WK_NBR,
	CST_TPT_TRN.FISC_QTR_NM AS FISC_QTR_NM,
	CST_TPT_TRN.FISC_MO_STRT_DT AS FISC_MO_STRT_DT,
	CST_TPT_TRN.FISC_MO_END_DT AS FISC_MO_END_DT,
	CST_DELV_TRN.DELV_TYPE_CD AS DELV_TYPE_CD,
	CST_DELV_TRN.DELV_CRT_DTTM AS DELV_CRT_DTTM,
	CST_DELV_TRN.MATL_NUM AS MATL_NUM,
	CST_DELV_TRN.RTE_NUM AS RTE_NUM,
	CST_DELV_TRN.PICK_DTTM AS PICK_DTTM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY AS ACTL_SKU_DELV_QTY,
	CST_DELV_TRN.DELV_BASE_UOM_CD AS DELV_BASE_UOM_CD,
	CST_DELV_TRN.ACTL_SLS_UNIT_DELV_QTY AS ACTL_SLS_UNIT_DELV_QTY,
	CST_DELV_TRN.MATL_SHRT_DESC AS MATL_SHRT_DESC,
	CST_DELV_TRN.GLBL_BRND_DESC AS GLBL_BRND_DESC,
	CST_DELV_TRN.RGN_BRND_DESC AS RGN_BRND_DESC,
	CST_DELV_TRN.RGN_MEGA_BRND_DESC AS RGN_MEGA_BRND_DESC,
	CST_DELV_TRN.PROD_CAT_DESC AS PROD_CAT_DESC,
	CST_DELV_TRN.TRSPN_GRP_CD AS TRSPN_GRP_CD,
	CST_DELV_TRN.RGN_BASE_PROD_DESC AS RGN_BASE_PROD_DESC,
	CST_DELV_TRN.RGN_VRNT_DESC AS RGN_VRNT_DESC,
	CST_DELV_TRN.RGN_PUT_UP_DESC AS RGN_PUT_UP_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_1_DESC AS MATL_GLOBL_HIER_1_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_2_DESC AS MATL_GLOBL_HIER_2_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_3_DESC AS MATL_GLOBL_HIER_3_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_4_DESC AS MATL_GLOBL_HIER_4_DESC,
	CST_DELV_TRN.MATL_GLOBL_HIER_5_DESC AS MATL_GLOBL_HIER_5_DESC,
	CST_MATL_UOM.GRS_WT_MEAS_PC AS GRS_WT_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS FCTR_NUMRTR_MEAS_CS,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_CS AS FCTR_DNMNTR_MEAS_CS,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PC AS FCTR_NUMRTR_MEAS_PC,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PC AS FCTR_DNMNTR_MEAS_PC,
	CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS FCTR_NUMRTR_MEAS_PL,
	CST_MATL_UOM.FCTR_DNMNTR_MEAS_PL AS FCTR_DNMNTR_MEAS_PL,
	CST_MATL_UOM.VOL_MEAS_CS AS VOL_MEAS_CS,
	CST_MATL_UOM.VOL_MEAS_PC AS VOL_MEAS_PC,
	CST_MATL_UOM.VOL_UOM_MEAS AS VOL_UOM_MEAS,
	CST_MATL_UOM.VOL_MEAS_PL AS VOL_MEAS_PL,
	CST_MATL_UOM.CS_PER_PLLT_UOM AS CS_PER_PLLT_UOM,
	CST_TPT_TRN.TRSPN_OTH_COST_AMT AS TRSPN_OTH_COST_AMT,
	CST_TPT_TRN.FUEL_SURC_COST_AMT AS FUEL_SURC_COST_AMT,
	CST_TPT_TRN.MLT_DRP_COST_AMT AS MLT_DRP_COST_AMT,
	CST_TPT_TRN.OVNT_COST_AMT AS OVNT_COST_AMT,
	CST_TPT_TRN.TRAVL_DSTC_COST_AMT AS TRAVL_DSTC_COST_AMT,
	CST_TPT_TRN.UNLD_COST_AMT AS UNLD_COST_AMT,
	CST_TPT_TRN.WAIT_TIME_COST_AMT AS WAIT_TIME_COST_AMT,
	CST_TPT_TRN.WT_AMT_COST AS WT_AMT_COST,
	CST_TPT_TRN.CROS_DK_COST_AMT AS CROS_DK_COST_AMT,
	CST_TPT_TRN.TRSPN_BASE_RT AS TRSPN_BASE_RT,
	CST_TPT_TRN.PER_KM_TRSPN_COST_AMT AS PER_KM_TRSPN_COST_AMT,
	CST_TPT_TRN.UTLZ_LTL_LCL_PCT AS UTLZ_LTL_LCL_PCT,
	CST_TPT_TRN.DELV_DSTC_IN_KM AS DELV_DSTC_IN_KM,
	CST_TPT_TRN.BILL_OF_LDNG AS BILL_OF_LDNG,
	CST_TPT_TRN.SHIP_MODE AS SHIP_MODE,
	CST_TPT_TRN.TRK_MAX_CAPY_CBM AS TRK_MAX_CAPY_CBM,
	CST_TPT_TRN.TRK_MAX_CAPY_KG AS TRK_MAX_CAPY_KG,
	CST_TPT_TRN.GRS_VOL_CBM AS GRS_VOL_CBM,
	CST_TPT_TRN.NET_VOL_CBM AS NET_VOL_CBM,
	CST_TPT_TRN.TRSPN_TYPE_CD AS TRSPN_TYPE_CD,
	CST_TPT_TRN.SHIP_TYPE_CD AS SHIP_TYPE_CD,
	CST_TPT_TRN.NET_WT_QTY AS NET_WT_QTY,
	CST_TPT_TRN.GRS_WT_QTY AS GRS_WT_QTY,
	CST_TPT_TRN.CHRG_MECH_CD AS CHRG_MECH_CD,
	CST_TPT_TRN.RT_CARD_ID AS RT_CARD_ID,
	CST_TPT_TRN.ORIG_CD AS ORIG_CD,
	CST_TPT_TRN.DEST_CD AS DEST_CD,
	CST_TPT_TRN.SNDR_ST_CD AS SNDR_ST_CD,
	CST_TPT_TRN.RCVR_ST_CD AS RCVR_ST_CD,
	CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT AS OUTB_TRSPN_INCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT AS OUTB_TRSPN_EXCL_TAX_COST_AMT,
	CST_TPT_TRN.OUTB_TRSPN_TAX_AMT AS OUTB_TRSPN_TAX_AMT,
	CST_TPT_TRN.DIST_TRVL_RATE_AMT AS DIST_TRVL_RATE_AMT,
	CST_TPT_TRN.WAIT_TIME_RATE_AMT AS WAIT_TIME_RATE_AMT,
	CST_TPT_TRN.RATE_PER_KG_AMT AS RATE_PER_KG_AMT,
	CST_TPT_TRN.FUEL_SURC_PCT AS FUEL_SURC_PCT,
	CST_TPT_TRN.DELV_VEND_NM AS DELV_VEND_NM,
	CST_TPT_TRN.LANE_ID AS LANE_ID,
	CST_TPT_TRN.CARR_NM AS CARR_NM,
	CST_TPT_TRN.TRK_TYPE_DESC AS TRK_TYPE_DESC,
	CST_TPT_TRN.ACTL_DC_DSPCH_FRM_DTTM AS ACTL_DC_DSPCH_FRM_DTTM,
	CST_TPT_TRN.SHIP_REF_NUM AS SHIP_REF_NUM,
	CST_TPT_TRN.SHIP_PRIR_DESC AS SHIP_PRIR_DESC,
	CST_TPT_TRN.OUTB_EXTRA_COST_AMT AS OUTB_EXTRA_COST_AMT,
	CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT AS OUTB_TPT_VOL_COST_AMT,
	CST_TPT_TRN.DELV_DTTM AS DELV_DTTM,
	CST_WH_TRN.LBR_COST_AMT_PL AS LBR_COST_AMT_PL,
	CST_WH_TRN.LBR_COST_AMT_CS AS LBR_COST_AMT_CS,
	CST_WH_TRN.LBR_COST_AMT_PC AS LBR_COST_AMT_PC,
	CST_WH_TRN.TTL_CUST_SRVC_COST_AMT AS TTL_CUST_SRVC_COST_AMT,
	CST_WH_TRN.FX_COST_AMT AS FX_COST_AMT,
	CST_WH_TRN.STRG_COST_AMT AS STRG_COST_AMT,
	CST_WH_TRN.OTH_COST_AMT AS OTH_COST_AMT,
	CST_WH_TRN.CNSUM_COST_AMT AS CNSUM_COST_AMT,
	CST_WH_TRN.OUTB_HNDG_COST_AMT AS OUTB_HNDG_COST_AMT,
	CST_WH_TRN.TTL_WH_COST_AMT AS TTL_WH_COST_AMT,
	CASE
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PC', 'EA') THEN CST_SLS_TRN.SLS_ORDR_QTY
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD IN ('PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL)
	WHEN CST_SLS_TRN.ORDR_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN (CST_SLS_TRN.SLS_ORDR_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS)
	ELSE 0
	END AS SLS_ORDR_QTY_PC,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS SLS_ORDR_QTY_CASE,
	CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC AS SLS_ORDR_QTY_PC_CBM,
	CST_SLS_TRN.SLS_ORDR_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS SLS_ORDR_QTY_PLLT,
	CASE
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PC', 'EA') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('CSE', 'CA', 'CS') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD IN ('PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL
	WHEN CST_DELV_TRN.DELV_BASE_UOM_CD NOT IN ('PC', 'EA', 'CSE', 'CA', 'CS', 'PL', 'PAL') THEN CST_DELV_TRN.ACTL_SKU_DELV_QTY * MATL_ALT_UOM.FCTR_NUMRTR_MEAS / MATL_ALT_UOM.FCTR_DNMNTR_MEAS
	ELSE 0
	END AS ACTL_DELV_QTY_PC,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS AS ACTL_DELV_QTY_CASE,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY * CST_MATL_UOM.VOL_MEAS_PC AS ACTL_DELV_QTY_PC_CBM,
	CST_DELV_TRN.ACTL_SKU_DELV_QTY / CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL AS ACTL_DELV_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT AS PICK_PACK_QTY_PLLT,
	CST_WH_TRN.DELV_PICK_PACK_QTY_CASE AS PICK_PACK_QTY_CASE,
	CST_WH_TRN.DELV_PICK_PACK_QTY_PC AS PICK_PACK_QTY_PC,
	(NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) AS TTL_DELV_COST_AMT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC)) AS TTL_DELV_COST_AMT_CBM,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL) AS TTL_DELV_COST_AMT_PLLT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS) AS TTL_DELV_COST_AMT_CASE,
	CST_SLS_TRN.LCL_CRNCY_CD AS LCL_CRNCY_CD,
	CST_SLS_TRN.SLS_ITEM_COST_AMT AS SLS_ITEM_COST_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_1_AMT AS SLS_ITEM_SUB_1_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_2_AMT AS SLS_ITEM_SUB_2_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_3_AMT AS SLS_ITEM_SUB_3_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_4_AMT AS SLS_ITEM_SUB_4_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_5_AMT AS SLS_ITEM_SUB_5_USD_AMT,
	CST_SLS_TRN.SLS_ITEM_SUB_6_AMT AS SLS_ITEM_SUB_6_USD_AMT,
	NVL(CST_SLS_TRN.NET_VAL_AMT_SLS/CST_SLS_TRN.SLS_UOM_ORDR_QTY,0) AS NET_VAL_USD_AMT_SLS,
	CST_WH_TRN.CNSUM_COST_AMT AS CNSUM_COST_USD_AMT,
	CST_WH_TRN.FX_COST_AMT AS FX_COST_USD_AMT,
	CST_WH_TRN.OTH_COST_AMT AS OTH_COST_USD_AMT,
	CST_WH_TRN.OUTB_HNDG_COST_AMT AS OUTB_HNDG_COST_USD_AMT,
	CST_WH_TRN.LBR_COST_AMT_PL AS LBR_COST_USD_AMT_PL,
	CST_WH_TRN.LBR_COST_AMT_CS AS LBR_COST_USD_AMT_CS,
	CST_WH_TRN.STRG_COST_AMT AS STRG_COST_USD_AMT,
	CST_WH_TRN.TTL_CUST_SRVC_COST_AMT AS TTL_CUST_SRVC_COST_USD_AMT,
	CST_WH_TRN.LBR_COST_AMT_PC AS LBR_COST_USD_AMT_PC,
	CST_WH_TRN.TTL_WH_COST_AMT AS TTL_WH_COST_USD_AMT,
	CST_TPT_TRN.CROS_DK_COST_AMT AS CROS_DK_COST_USD_AMT,
	CST_TPT_TRN.FUEL_SURC_COST_AMT AS FUEL_SURC_COST_USD_AMT,
	CST_TPT_TRN.MLT_DRP_COST_AMT AS MLT_DRP_COST_USD_AMT,
	CST_TPT_TRN.OUTB_EXTRA_COST_AMT AS OUTB_EXTRA_COST_USD_AMT,
	CST_TPT_TRN.OUTB_TPT_VOL_COST_AMT AS OUTB_TPT_VOL_COST_USD_AMT,
	CST_TPT_TRN.OVNT_COST_AMT AS OVNT_COST_USD_AMT,
	CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT AS OUTB_TRSN_EXCL_TAX_CST_USD_AMT,
	CST_TPT_TRN.OUTB_TRSPN_INCL_TAX_COST_AMT AS OUTB_TRSN_INCL_TAX_CST_USD_AMT,
	CST_TPT_TRN.OUTB_TRSPN_TAX_AMT AS OUTB_TRSN_TAX_USD_AMT,
	CST_TPT_TRN.TRSPN_BASE_RT AS TRSPN_BASE_RT_USD_AMT,
	CST_TPT_TRN.PER_KM_TRSPN_COST_AMT AS PER_KM_TRSPN_COST_USD_AMT,
	CST_TPT_TRN.TRSPN_OTH_COST_AMT AS TRSPN_OTH_COST_USD_AMT,
	CST_TPT_TRN.TRAVL_DSTC_COST_AMT AS TRAVL_DSTC_COST_USD_AMT,
	CST_TPT_TRN.UNLD_COST_AMT AS UNLD_COST_USD_AMT,
	CST_TPT_TRN.WAIT_TIME_COST_AMT AS WAIT_TIME_COST_USD_AMT,
	CST_TPT_TRN.WAIT_TIME_RATE_AMT AS WAIT_TIME_RATE_USD_AMT,
	CST_TPT_TRN.WT_AMT_COST AS WT_AMT_COST_USD,
	CST_TPT_TRN.DIST_TRVL_RATE_AMT AS DIST_TRVL_RATE_USD_AMT,
	CST_TPT_TRN.RATE_PER_KG_AMT AS RATE_PER_KG_USD_AMT,
	(NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) AS TTL_DELV_COST_USD_AMT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / (CST_SLS_TRN.SLS_ORDR_QTY * CST_MATL_UOM.VOL_MEAS_PC)) AS TTL_DELV_COST_USD_AMT_CBM,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_PLLT * CST_MATL_UOM.FCTR_NUMRTR_MEAS_PL) AS TTL_DELV_COST_USD_AMT_PLLT,
	((NVL(CST_WH_TRN.TTL_CUST_SRVC_COST_AMT, 0) + NVL(CST_WH_TRN.STRG_COST_AMT, 0) + NVL(CST_WH_TRN.OUTB_HNDG_COST_AMT, 0) + NVL(CST_WH_TRN.OTH_COST_AMT, 0) + NVL(CST_WH_TRN.FX_COST_AMT, 0) + NVL(CST_WH_TRN.CNSUM_COST_AMT, 0) + NVL(CST_TPT_TRN.OUTB_TRSPN_EXCL_TAX_COST_AMT, 0)) / CST_DELV_TRN.ACTL_SKU_DELV_QTY) * (CST_WH_TRN.DELV_PICK_PACK_QTY_CASE * CST_MATL_UOM.FCTR_NUMRTR_MEAS_CS) AS TTL_DELV_COST_USD_AMT_CASE,
	CST_SLS_TRN.SLS_ORDR_GEN_NM AS SLS_ORDR_GEN_NM,
	CST_SLS_TRN.REGION_INC AS REGION_INC,
	CST_SLS_TRN.LINE_ITEM_CAT_CD AS LINE_ITEM_CAT_CD,
	CST_DELV_TRN.ACTL_GI_DT AS ACTL_GI_DT,
	CASE WHEN CST_TPT_TRN.TRSPN_TYPE_CD = 'BACK' THEN 'N'
	ELSE CUST_DIM.NON_HOME_DC_FL_IND
	END AS OUT_OF_SRVC_IND,
	CST_SLS_TRN.KEY_CUST_NM AS KEY_CUST_NM,
	CST_SLS_TRN.KEY_CUST_NUM AS KEY_CUST_NUM,
	CST_TPT_TRN.LD_NUM AS LD_NUM,
	CST_TPT_TRN.PLAN_GI_DT AS PLAN_GI_DT,
	CST_TPT_TRN.INVC_CRT_DT AS INVC_CRT_DT,
	CST_TPT_TRN.SLS_INVC_NUM AS SLS_INVC_NUM,
	CST_TPT_TRN.PO_NUM AS PO_NUM,
	CST_TPT_TRN.CARR_CD AS CARR_CD,
	CST_TPT_TRN.CMMDTY_CD AS CMMDTY_CD,
	CST_TPT_TRN.CARR_PRO_NUM AS CARR_PRO_NUM,
	CST_TPT_TRN.TMS_MATCH_IND AS TMS_MATCH_IND,
    CST_TPT_TRN.FRGHT_MATCH_IND AS FRGHT_MATCH_IND,
	CST_TPT_TRN.EST_FUEL_SURC_AMT AS EST_FUEL_SURC_AMT,
	CST_TPT_TRN.TOT_ACCSORIAL_PD_AMT AS TOT_ACCSORIAL_PD_AMT,
	CST_TPT_TRN.TOT_FRGHT_CHRG_AMT AS TOT_FRGHT_CHRG_AMT,
	CST_TPT_TRN.TOT_PLAN_COST_AMT AS TOT_PLAN_COST_AMT,
	CST_TPT_TRN.EST_ACTL_DIFF_COST_AMT AS EST_ACTL_DIFF_COST_AMT,
	CST_TPT_TRN.GRS_WT_MEAS AS GRS_WT_MEAS,
	CST_TPT_TRN.INVC_LINE_ITEM_VOL_MEAS AS INVC_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.GRS_WT_ITM_QTY AS GRS_WT_ITM_QTY,
	CST_TPT_TRN.SLS_LINE_ITEM_VOL_MEAS AS SLS_LINE_ITEM_VOL_MEAS,
	CST_TPT_TRN.PLNT_ADDR_NUM AS PLNT_ADDR_NUM,
	CST_TPT_TRN.SHIP_COND_CD AS SHIP_COND_CD,
  CASE
	WHEN CST_SLS_TRN.KEY_CUST_NM IS NULL
	THEN CONCAT('CZ','_',CST_SLS_TRN.SOLD_TO_CUST_NM,'_',CST_SLS_TRN.SHIP_TO_ST_PRVNC_CD,'_',UPPER(CST_SLS_TRN.SHIP_TO_CUST_CITY_NM),'_',CST_SLS_TRN.SHIP_TO_CUST_PSTL_NUM)
	ELSE CONCAT('CZ','_',CST_SLS_TRN.KEY_CUST_NM,'_',CST_SLS_TRN.SHIP_TO_ST_PRVNC_CD,'_',UPPER(CST_SLS_TRN.SHIP_TO_CUST_CITY_NM),'_',CST_SLS_TRN.SHIP_TO_CUST_PSTL_NUM)
  END  AS NTWK_SHIP_TO_NM,
	CST_TPT_TRN.INVC_CNT AS INVC_CNT,
	CST_TPT_TRN.SLS_CNFRM_CASE_QTY AS SLS_CNFRM_CASE_QTY,
	CST_TPT_TRN.CUST_UNIT_SLS_CNFRM_QTY AS CUST_UNIT_SLS_CNFRM_QTY,
	CST_TPT_TRN.SLS_CNFRM_EA_QTY AS SLS_CNFRM_EA_QTY,
	CST_TPT_TRN.INVC_EA_QTY AS INVC_EA_QTY,
	CST_TPT_TRN.INVC_CASE_QTY AS INVC_CASE_QTY,
	CST_TPT_TRN.SLS_ORDR_CASE_QTY AS SLS_ORDR_CASE_QTY,
	CST_TPT_TRN.SNGL_SRC_MATL_IND AS SNGL_SRC_MATL_IND,
	CST_TPT_TRN.PMT_SYS_DTTM AS PMT_SYS_DTTM,
	CST_TPT_TRN.CROSSDK_WT_BAS_COST_AMT AS CROSSDK_WT_BAS_COST_AMT,
	CST_TPT_TRN.FUEL_SURC_WT_BAS_COST_AMT AS FUEL_SURC_WT_BAS_COST_AMT,
	CST_TPT_TRN.MULTIDROP_WT_BAS_COST_AMT AS MULTIDROP_WT_BAS_COST_AMT,
	CST_TPT_TRN.OUTB_WT_BAS_COST_EXTRA_AMT AS OUTB_WT_BAS_COST_EXTRA_AMT,
	CST_TPT_TRN.OVNT_WT_BAS_COST_AMT AS OVNT_WT_BAS_COST_AMT,
	CST_TPT_TRN.TRNSP_WT_BAS_COST_TAX_AMT AS TRNSP_WT_BAS_COST_TAX_AMT,
	CST_TPT_TRN.TRNSP_WT_BAS_COST_INC_TAX_AMT AS TRNSP_WT_BAS_COST_INC_TAX_AMT,
	CST_TPT_TRN.TRNSP_WT_BAS_COST_AMT AS TRNSP_WT_BAS_COST_AMT,
	CST_TPT_TRN.TRNSP_WT_BAS_BASE_RT_AMT AS TRNSP_WT_BAS_BASE_RT_AMT,
	CST_TPT_TRN.TRNSP_WT_BAS_OTH_COST_AMT AS TRNSP_WT_BAS_OTH_COST_AMT,
	CST_TPT_TRN.UNLDING_WT_BAS_COST_AMT AS UNLDING_WT_BAS_COST_AMT,
	NULL AS TRNSP_WT_BAS_COST_EXCL_TAX_AMT,
	NULL AS WAIT_TIME_BAS_COST_AMT,
	NULL AS WT_AMT_COST_AMT,
	NULL AS TRAVL_DSTC_BAS_COST_AMT,
	NULL AS UNLD_COST_USD_WT_BAS_AMT,
	NULL AS CROSSDK_COST_USD_WT_BAS_AMT,
	NULL AS FUEL_SURC_COST_USD_WT_BAS_AMT,
	NULL AS MULTIDROP_COST_USD_WT_BAS_AMT,
	NULL AS OVNT_COST_USD_WT_BASE_AMT,
	NULL AS OUTB_EXCL_TAX_USD_WT_BAS_AMT,
	NULL AS OUTB_INCL_TAX_USD_WT_BAS_AMT,
	NULL AS OUTB_TRNSP_TAX_USD_WT_BAS_AMT,
	NULL AS TRNSP_BASE_RT_USD_WT_BAS_AMT,
	NULL AS TRNSP_OTH_COST_USD_WT_BAS_AMT,
	NULL AS TRAVL_DSTC_COST_USD_WT_BAS_AMT,
	NULL AS WAIT_TIME_COST_USD_WT_BAS_AMT,
	NULL AS WT_AMT_COST_WT_BAS_AMT,
	NULL AS OUTB_EXTRA_COST_USD_WT_BAS_AMT,
	CST_TPT_TRN.EST_WT_BAS_FUEL_SURC_AMT AS EST_WT_BAS_FUEL_SURC_AMT,
	CASE
	 WHEN CST_TPT_TRN.FRGHT_MATCH_IND = 'Y'
	 THEN CST_TPT_TRN.TOT_ACCSORIAL_PD_WT_BAS_AMT
	 WHEN FRGHT_MATCH_IND = 'N'
	 THEN 0
	END AS TOT_ACCSORIAL_PD_WT_BAS_AMT,
	CST_TPT_TRN.TOT_FRGHT_CHRG_WT_BAS_AMT AS TOT_FRGHT_CHRG_WT_BAS_AMT,
	CST_TPT_TRN.TOT_PLAN_WT_BAS_COST_AMT AS TOT_PLAN_WT_BAS_COST_AMT,
	CST_SLS_TRN.ORIG_RQST_DELV_DT AS ORIG_RQST_DELV_DT,
	CST_SLS_TRN.RQST_DELV_DT AS RQST_DELV_DT,
	CST_TPT_TRN.PRC_PCDR1_AMT AS PRC_PCDR1_AMT,
	CST_TPT_TRN.BRND_DESC AS BRND_DESC,
	CST_TPT_TRN.GBU_DESC AS GBU_DESC,
	CST_TPT_TRN.FRAN_DESC AS FRAN_DESC,
	CST_TPT_TRN.MATL_RGM_CLSN_CD AS MATL_RGM_CLSN_CD,
	CST_TPT_TRN.FISC_CUR_MO_IND AS FISC_CUR_MO_IND,
	CST_TPT_TRN.REL_TO_TDY_FISC_MO_CNT AS REL_TO_TDY_FISC_MO_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_QTR_CNT AS REL_TO_TDY_FISC_QTR_CNT,
	CST_TPT_TRN.REL_TO_TDY_FISC_YR_CNT AS REL_TO_TDY_FISC_YR_CNT,
	CST_TPT_TRN.CAL_DT AS CAL_DT,
	CST_TPT_TRN.FISC_QTR_STRT_DT AS FISC_QTR_STRT_DT,
	CST_TPT_TRN.FISC_QE_DT AS FISC_QE_DT,
	CST_TPT_TRN.FISC_WK_STRT_DT AS FISC_WK_STRT_DT,
	CST_TPT_TRN.FISC_WK_END_DT AS FISC_WK_END_DT,
	CASE WHEN LINE_ITEM_CAT_CD IN ('ZHAQ','ZTAQ','ZDB8','ZDBQ','ZENF','ZHOR','ZSDT','ZDN8','TANN','ZSAQ','TAN','ZDDQ') THEN 'x'
    ELSE '' END AS NON_CMPNT_IND,
	NULL AS CUST_SEG_CD,
	'SRC_SYS_CD|^DELV_NUM|^DELV_LINE_NBR|^SLS_ORDR_NUM|^SLS_ORDR_LINE_NBR' AS LOGL_KEY_CMBN_COL_NM,
	CONCAT(CST_DELV_TRN.SRC_SYS_CD, '|^', CST_DELV_TRN.DELV_NUM, '|^', CST_DELV_TRN.DELV_LINE_NBR, '|^', CST_SLS_TRN.SLS_ORDR_NUM, '|^', CST_SLS_TRN.SLS_ORDR_LINE_NBR) AS LOGL_KEY_CMBN_COL_VAL,
	CAST(CURRENT_TIMESTAMP() AS BIGINT) AS DAI_BTCH_ID,
	CURRENT_TIMESTAMP() AS DAI_UPDT_DTTM,
	CURRENT_TIMESTAMP() AS DAI_CRT_DTTM,
	CST_DELV_TRN.SRC_SYS_CD AS SRC_SYS_CD,
	CST_DELV_TRN.CRT_YR_NBR AS CRT_YR_NBR,
	CST_DELV_TRN.CRT_MO_NBR AS CRT_MO_NBR
FROM DELV.CST_DELV_TRN
INNER JOIN DELV.CST_SLS_TRN ON CST_DELV_TRN.DELV_NUM = CST_SLS_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_SLS_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_SLS_TRN.SRC_SYS_CD
INNER JOIN DELIV_FILES.COUNTRY_INC ON CST_DELV_TRN.SRC_SYS_CD = COUNTRY_INC.SRC_SYS_CD AND CST_SLS_TRN.PLNT_CTRY_CD = COUNTRY_INC.PLNT_CTRY_CD
LEFT OUTER JOIN DELV.CST_MATL_UOM ON CST_DELV_TRN.DELV_NUM = CST_MATL_UOM.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_MATL_UOM.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_MATL_UOM.SRC_SYS_CD
INNER JOIN DELV.CST_TPT_TRN ON CST_DELV_TRN.DELV_NUM = CST_TPT_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_TPT_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_TPT_TRN.SRC_SYS_CD
LEFT OUTER JOIN DELV.CST_WH_TRN ON CST_DELV_TRN.DELV_NUM = CST_WH_TRN.DELV_NUM AND CST_DELV_TRN.DELV_LINE_NBR = CST_WH_TRN.DELV_LINE_NBR AND CST_DELV_TRN.SRC_SYS_CD = CST_WH_TRN.SRC_SYS_CD
LEFT OUTER JOIN SC_CORE.MATL_ALT_UOM ON MATL_ALT_UOM.MATL_NUM = CST_MATL_UOM.MATL_NUM AND cst_sls_trn.ORDR_BASE_UOM_CD = matl_alt_uom.matl_alt_uom_cd AND CST_DELV_TRN.SRC_SYS_CD = MATL_ALT_UOM.SRC_SYS_CD
LEFT OUTER JOIN CTE_CUST_DIM  AS CUST_DIM ON CST_TPT_TRN.LD_NUM= CUST_DIM.EXTRNL_REF_2_CD and CST_TPT_TRN.BILL_OF_LDNG=CUST_DIM.EXTRNL_REF_1_CD AND CST_TPT_TRN.SRC_SYS_CD=CUST_DIM.SRC_SYS_CD AND CST_TPT_TRN.SLS_ORDR_NUM=CUST_DIM.SLS_ORDR_NUM AND CST_TPT_TRN.SLS_ORDR_LINE_NBR =CUST_DIM.SLS_ORDR_LINE_NBR
WHERE CST_SLS_TRN.SRC_SYS_CD = 'US1' AND CST_DELV_TRN.ACTL_SKU_DELV_QTY > 0 AND UPPER(COUNTRY_INC.COUNTRY_INC) ='YES';

-- COMMAND ----------

%python
execution_end_time = datetime.utcnow().strftime(format_string)
DML_logging_path = "/Workspace/Main/DC/cicd/cons_digital_core/databricks/DML_Logging"

try:

  dbutils.notebook.run(path = DML_logging_path, timeout_seconds = 0, arguments = {"job_schedule_id":job_schedule_id, "adf_run_id":adf_run_id, "execution_start_time":execution_start_time, "execution_end_time":execution_end_time, "job_status":job_run_status, "notebook_path":notebook_path, "error_desc": None} )

except Exception as e:
  pass
